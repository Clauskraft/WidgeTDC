import{j as s,D as A,a7 as ie,F as H,a0 as ae,G as le,Y as ce,_ as de,H as pe,a8 as he,r as S,f as ue,a9 as xe,P as me,aa as ge,ab as fe,ac as ye,ad as we,ae as Y,af as be,ag as ve,R as ke,h as U,S as V,x as je}from"./ui-d27jHJxv.js";import{c as Ne,p as Se}from"./index-D3cQhnRP.js";import"./vendor-BerfLJhL.js";import"./grid-B9N6NCa2.js";const M={search:"#00FFFF",expanded:"#8B5CF6",manual:"#00FF88",suggested:"#FF8800"},Ee={web:"#3B82F6",drive:"#10B981",pubmed:"#EF4444",wikipedia:"#6B7280",manual:"#F59E0B"},Ce={relates_to:"#6B7280",causes:"#EF4444",part_of:"#3B82F6",leads_to:"#10B981",contradicts:"#F59E0B",supports:"#8B5CF6"},L=()=>`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,J=()=>`edge-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,Ie=(t,n,e,r)=>{if(t.length===0)return t;const o=50,a=5e3,u=.05,p=.9;let l=t.map(d=>({id:d.id,x:d.position.x||e+(Math.random()-.5)*200,y:d.position.y||r+(Math.random()-.5)*200,vx:0,vy:0,fixed:d.isRoot}));for(let d=0;d<o;d++){for(let h=0;h<l.length;h++)for(let i=h+1;i<l.length;i++){const x=l[i].x-l[h].x,m=l[i].y-l[h].y,g=Math.sqrt(x*x+m*m)||1,w=a/(g*g),v=x/g*w,y=m/g*w;l[h].fixed||(l[h].vx-=v,l[h].vy-=y),l[i].fixed||(l[i].vx+=v,l[i].vy+=y)}for(const h of n){const i=l.find(N=>N.id===h.sourceId),x=l.find(N=>N.id===h.targetId);if(!i||!x)continue;const m=x.x-i.x,g=x.y-i.y,w=Math.sqrt(m*m+g*g)||1,v=w*u,y=m/w*v,k=g/w*v;i.fixed||(i.vx+=y,i.vy+=k),x.fixed||(x.vx-=y,x.vy-=k)}for(const h of l)h.fixed||(h.x+=h.vx*p,h.y+=h.vy*p,h.vx*=p,h.vy*=p)}return t.map(d=>{const h=l.find(i=>i.id===d.id);return h?{...d,position:{x:h.x,y:h.y}}:d})},Me=Ne()(Se((t,n)=>({nodes:[],edges:[],selectedNodeId:null,hoveredNodeId:null,viewport:{x:0,y:0,zoom:1},isSearching:!1,searchQuery:"",searchResults:[],autoTrackEnabled:!1,trackingInterval:3e4,history:[],historyIndex:-1,setSearchQuery:e=>t({searchQuery:e}),setSearching:e=>t({isSearching:e}),setSearchResults:e=>t({searchResults:e}),clearSearch:()=>t({searchQuery:"",searchResults:[],isSearching:!1}),addNodeFromSearch:(e,r)=>{const a=n().nodes.length===0,u=600,p=400,l={id:L(),label:e,description:r,type:"search",source:"web",position:a?{x:u,y:p}:{x:u+(Math.random()-.5)*300,y:p+(Math.random()-.5)*300},size:a?50:40,color:M.search,isRoot:a,createdAt:new Date().toISOString()};return n().saveHistory(),t(d=>({nodes:[...d.nodes,l],selectedNodeId:l.id,searchQuery:"",searchResults:[]})),l},addNode:e=>{const r={...e,id:L(),createdAt:new Date().toISOString()};return n().saveHistory(),t(o=>({nodes:[...o.nodes,r]})),r},removeNode:e=>{n().saveHistory(),t(r=>({nodes:r.nodes.filter(o=>o.id!==e),edges:r.edges.filter(o=>o.sourceId!==e&&o.targetId!==e),selectedNodeId:r.selectedNodeId===e?null:r.selectedNodeId}))},updateNode:(e,r)=>{t(o=>({nodes:o.nodes.map(a=>a.id===e?{...a,...r}:a)}))},moveNode:(e,r)=>{t(o=>({nodes:o.nodes.map(a=>a.id===e?{...a,position:r}:a)}))},selectNode:e=>t({selectedNodeId:e}),hoverNode:e=>t({hoveredNodeId:e}),setNodeExpanding:(e,r)=>{t(o=>({nodes:o.nodes.map(a=>a.id===e?{...a,isExpanding:r}:a)}))},toggleNodeTracking:e=>{t(r=>({nodes:r.nodes.map(o=>o.id===e?{...o,isTracking:!o.isTracking}:o)}))},addEdge:e=>{const r={...e,id:J()};n().saveHistory(),t(o=>({edges:[...o.edges,r]}))},removeEdge:e=>{n().saveHistory(),t(r=>({edges:r.edges.filter(o=>o.id!==e)}))},updateEdge:(e,r)=>{t(o=>({edges:o.edges.map(a=>a.id===e?{...a,...r}:a)}))},expandNode:(e,r,o)=>{const u=n().nodes.find(i=>i.id===e);if(!u)return;n().saveHistory();const p=2*Math.PI/r.length,l=150,d=r.map((i,x)=>{const m=p*x-Math.PI/2;return{...i,id:L(),position:{x:u.position.x+Math.cos(m)*l,y:u.position.y+Math.sin(m)*l},size:35,color:M.expanded,createdAt:new Date().toISOString()}}),h=o.map((i,x)=>{var m;return{...i,id:J(),sourceId:e,targetId:((m=d[x])==null?void 0:m.id)||e}});t(i=>({nodes:[...i.nodes.map(x=>x.id===e?{...x,isExpanding:!1,expandedAt:new Date().toISOString()}:x),...d],edges:[...i.edges,...h]})),setTimeout(()=>n().applyForceLayout(),100)},setViewport:e=>t({viewport:e}),setZoom:e=>{const r=Math.max(.2,Math.min(3,e));t(o=>({viewport:{...o.viewport,zoom:r}}))},pan:(e,r)=>{t(o=>({viewport:{...o.viewport,x:o.viewport.x+e,y:o.viewport.y+r}}))},resetViewport:()=>t({viewport:{x:0,y:0,zoom:1}}),centerOnNode:e=>{const r=n(),o=r.nodes.find(a=>a.id===e);o&&t({viewport:{x:-o.position.x+600,y:-o.position.y+400,zoom:r.viewport.zoom}})},applyForceLayout:()=>{const e=n(),r=Ie(e.nodes,e.edges,600,400);t({nodes:r})},applyRadialLayout:()=>{const e=n(),r=e.nodes.find(i=>i.isRoot);if(!r)return;const o=600,a=400,u=150,p=new Map,l=[{id:r.id,level:0}];for(p.set(r.id,0);l.length>0;){const{id:i,level:x}=l.shift(),m=e.edges.filter(g=>g.sourceId===i||g.targetId===i);for(const g of m){const w=g.sourceId===i?g.targetId:g.sourceId;p.has(w)||(p.set(w,x+1),l.push({id:w,level:x+1}))}}const d=new Map;p.forEach((i,x)=>{d.has(i)||d.set(i,[]),d.get(i).push(x)});const h=e.nodes.map(i=>{const x=p.get(i.id)??0,m=d.get(x)??[i.id],g=m.indexOf(i.id),v=2*Math.PI/m.length*g-Math.PI/2,y=x*u;return{...i,position:{x:o+Math.cos(v)*y,y:a+Math.sin(v)*y}}});t({nodes:h})},setAutoTrack:e=>t({autoTrackEnabled:e}),setTrackingInterval:e=>t({trackingInterval:e}),saveHistory:()=>{const e=n(),r=e.history.slice(0,e.historyIndex+1);r.push({nodes:JSON.parse(JSON.stringify(e.nodes)),edges:JSON.parse(JSON.stringify(e.edges))}),t({history:r.slice(-50),historyIndex:r.length-1})},undo:()=>{const e=n();if(e.historyIndex>0){const r=e.history[e.historyIndex-1];t({nodes:r.nodes,edges:r.edges,historyIndex:e.historyIndex-1})}},redo:()=>{const e=n();if(e.historyIndex<e.history.length-1){const r=e.history[e.historyIndex+1];t({nodes:r.nodes,edges:r.edges,historyIndex:e.historyIndex+1})}},clear:()=>{n().saveHistory(),t({nodes:[],edges:[],selectedNodeId:null})},loadState:(e,r)=>{n().saveHistory(),t({nodes:e,edges:r})}}),{name:"mindmap-builder-storage",partialize:t=>({nodes:t.nodes,edges:t.edges,viewport:t.viewport,autoTrackEnabled:t.autoTrackEnabled})})),O="http://localhost:3000/api",Fe="ws://localhost:3001/mcp/ws",F=[{type:"vidensarkiv",enabled:!0,label:"Vidensarkiv",color:"#8B5CF6",icon:"ðŸ§ "},{type:"local_files",enabled:!0,label:"Lokale Filer",color:"#10B981",icon:"ðŸ“"},{type:"browser_history",enabled:!0,label:"Browser Historik",color:"#3B82F6",icon:"ðŸŒ"},{type:"outlook_emails",enabled:!0,label:"Outlook Emails",color:"#F59E0B",icon:"ðŸ“§"},{type:"web_search",enabled:!0,label:"Web SÃ¸gning",color:"#06B6D4",icon:"ðŸ”"},{type:"wikipedia",enabled:!0,label:"Wikipedia",color:"#6B7280",icon:"ðŸ“š"},{type:"pubmed",enabled:!0,label:"PubMed",color:"#EF4444",icon:"ðŸ”¬"},{type:"google_drive",enabled:!1,label:"Google Drive",color:"#4285F4",icon:"ðŸ“„"}];async function Oe(t,n=10){try{const e=await fetch(`${O}/vector/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,namespace:"vidensarkiv",limit:n})});return e.ok?(await e.json()).map(o=>{var a,u;return{id:o.id,title:Le(o.content),snippet:o.content.slice(0,200),source:((a=o.metadata)==null?void 0:a.source)||"web",url:(u=o.metadata)==null?void 0:u.url,relevance:o.similarity}}):(console.warn("[DataSource] Vidensarkiv search failed:",e.statusText),[])}catch(e){return console.error("[DataSource] Vidensarkiv error:",e),[]}}async function _e(t,n=10){try{const e=await fetch(`${O}/ingestion/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,source:"local_file_scanner",limit:n})});return e.ok?(await e.json()).map(o=>{var a;return{id:o.id,title:o.title||o.filename||"Fil",snippet:((a=o.content)==null?void 0:a.slice(0,200))||"",source:"drive",url:o.path,relevance:o.score||.5}}):[]}catch(e){return console.error("[DataSource] Local files error:",e),[]}}async function De(t,n=10){try{const e=await fetch(`${O}/ingestion/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,source:"browser_history",limit:n})});return e.ok?(await e.json()).map(o=>{var a;return{id:o.id,title:o.title||o.url||"Side",snippet:((a=o.content)==null?void 0:a.slice(0,200))||o.url||"",source:"web",url:o.url,relevance:o.score||.5}}):[]}catch(e){return console.error("[DataSource] Browser history error:",e),[]}}async function $e(t,n=10){try{const e=await fetch(`${O}/ingestion/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,source:"outlook_email",limit:n})});return e.ok?(await e.json()).map(o=>{var a,u;return{id:o.id,title:o.subject||o.title||"Email",snippet:((a=o.body)==null?void 0:a.slice(0,200))||((u=o.content)==null?void 0:u.slice(0,200))||"",source:"drive",url:o.mailId,relevance:o.score||.5}}):[]}catch(e){return console.error("[DataSource] Outlook error:",e),[]}}async function B(t,n,e={}){return new Promise(r=>{try{const o=new WebSocket(Fe),a=setTimeout(()=>{o.close(),r([])},1e4);o.onopen=()=>{o.send(JSON.stringify({type:"tool_call",tool:n,params:{query:t,...e}}))},o.onmessage=u=>{clearTimeout(a);try{const p=JSON.parse(u.data);if(p.type==="tool_result"&&p.result){const l=Array.isArray(p.result)?p.result:[p.result];r(l.map((d,h)=>{var i;return{id:d.id||`mcp-${n}-${h}`,title:d.title||d.name||t,snippet:d.snippet||d.description||((i=d.content)==null?void 0:i.slice(0,200))||"",source:n.includes("wiki")?"wikipedia":n.includes("pubmed")?"pubmed":"web",url:d.url||d.link,relevance:d.relevance||.7}}))}else r([])}catch{r([])}o.close()},o.onerror=()=>{clearTimeout(a),r([])}}catch(o){console.error("[DataSource] MCP error:",o),r([])}})}async function R(t,n=["vidensarkiv","local_files"],e=5){const r=[];n.includes("vidensarkiv")&&r.push(Oe(t,e)),n.includes("local_files")&&r.push(_e(t,e)),n.includes("browser_history")&&r.push(De(t,e)),n.includes("outlook_emails")&&r.push($e(t,e)),n.includes("web_search")&&r.push(B(t,"web_search",{limit:e})),n.includes("wikipedia")&&r.push(B(t,"mediawiki-mcp-server:search-page",{query:t,limit:e})),n.includes("pubmed")&&r.push(B(t,"pubmed-mcp-server:search_pubmed_key_words",{key_words:t,num_results:e}));const o=await Promise.allSettled(r),a=[];return o.forEach(u=>{u.status==="fulfilled"&&a.push(...u.value)}),a.sort((u,p)=>p.relevance-u.relevance).slice(0,e*2)}async function Te(t,n=["vidensarkiv","web_search"]){try{const e=await R(t.label,n,5),r=await fetch(`${O}/llm/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:`Baseret pÃ¥ emnet "${t.label}" og fÃ¸lgende sÃ¸geresultater, identificer 3-5 relaterede nÃ¸glebegreber der ville vÃ¦re relevante at udforske:

SÃ¸geresultater:
${e.map(l=>`- ${l.title}: ${l.snippet}`).join(`
`)}

Svar i JSON format:
{
  "concepts": [
    { "label": "Koncept navn", "relation": "relates_to|causes|part_of|leads_to", "description": "Kort beskrivelse" }
  ]
}`,max_tokens:500})});if(!r.ok)return X(t,e);const o=await r.json();let a;try{a=JSON.parse(o.text||o.content||"{}").concepts||[]}catch{return X(t,e)}const u=a.map(l=>({id:"",label:l.label,description:l.description,type:"expanded",source:ze(e,l.label),size:35,color:M.expanded,createdAt:new Date().toISOString()})),p=a.map(l=>({sourceId:t.id,targetId:"",label:l.relation,type:l.relation||"relates_to",weight:.7,animated:!0}));return{nodes:u,edges:p,suggestions:e.slice(0,3).map(l=>l.title)}}catch(e){return console.error("[DataSource] AI expansion error:",e),{nodes:[],edges:[]}}}function X(t,n){const e=n.slice(0,3).map(o=>({id:"",label:o.title.slice(0,30),description:o.snippet,type:"expanded",source:o.source,sourceUrl:o.url,size:35,color:M.expanded,createdAt:new Date().toISOString()})),r=e.map(()=>({sourceId:t.id,targetId:"",type:"relates_to",weight:.6,animated:!0}));return{nodes:e,edges:r}}function ze(t,n){const e=t.find(r=>r.title.toLowerCase().includes(n.toLowerCase())||n.toLowerCase().includes(r.title.toLowerCase()));return(e==null?void 0:e.source)||"web"}function Le(t){const n=t.match(/Title:\s*(.+?)(?:\n|$)/);if(n)return n[1].trim();const e=t.split(`
`)[0];return e.slice(0,50)+(e.length>50?"...":"")}const Be={vidensarkiv:A,local_files:pe,browser_history:de,outlook_emails:ce,web_search:le,wikipedia:ae,pubmed:H,google_drive:H},Re=t=>({vidensarkiv:"Alle indekserede dokumenter og data",local_files:"Scannede filer fra din computer",browser_history:"BesÃ¸gte websites og sÃ¸gninger",outlook_emails:"Emails fra Outlook",web_search:"SÃ¸g pÃ¥ internettet",wikipedia:"Wikipedia artikler",pubmed:"Medicinske forskningsartikler",google_drive:"Google Drive dokumenter"})[t]||"",Ae=({onClose:t})=>{const n=r=>{const o=F.find(a=>a.type===r);o&&(o.enabled=!o.enabled)},e=F.filter(r=>r.enabled).length;return s.jsxs("div",{className:"absolute top-16 right-4 z-40 w-80 bg-slate-900/95 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/10 bg-white/5",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(A,{className:"w-4 h-4 text-purple-400"}),s.jsx("h3",{className:"text-sm font-medium text-white",children:"Data Kilder"})]}),s.jsx("button",{onClick:t,className:"p-1 hover:bg-white/10 rounded transition-colors",children:s.jsx(ie,{className:"w-4 h-4 text-white/60"})})]}),s.jsx("div",{className:"p-2 max-h-[400px] overflow-y-auto",children:F.map(r=>{const o=Be[r.type];return s.jsxs("button",{onClick:()=>n(r.type),className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all ${r.enabled?"bg-white/10 border border-white/20":"hover:bg-white/5 border border-transparent"}`,children:[s.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:`${r.color}20`,color:r.color},children:s.jsx(o,{className:"w-4 h-4"})}),s.jsxs("div",{className:"flex-1 text-left",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm font-medium text-white",children:r.label}),s.jsx("span",{className:"text-xs text-white/40",children:r.icon})]}),s.jsx("span",{className:"text-[10px] text-white/40",children:Re(r.type)})]}),s.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center transition-colors ${r.enabled?"bg-green-500":"bg-white/10"}`,children:r.enabled&&s.jsx(he,{className:"w-3 h-3 text-white"})})]},r.type)})}),s.jsx("div",{className:"px-4 py-2.5 border-t border-white/10 bg-white/5",children:s.jsxs("span",{className:"text-[10px] text-white/40",children:[e," af ",F.length," kilder aktive"]})})]})},Pe=({node:t,isSelected:n,isHovered:e,zoom:r,onSelect:o,onHover:a,onMove:u,onExpand:p,onDelete:l,onToggleTracking:d})=>{const[h,i]=S.useState(!1),[x,m]=S.useState({x:0,y:0}),g=t.color||M[t.type],w=t.source?Ee[t.source]:g,v=y=>{y.stopPropagation(),i(!0),m({x:y.clientX-t.position.x*r,y:y.clientY-t.position.y*r}),o()};return S.useEffect(()=>{if(!h)return;const y=N=>{u({x:(N.clientX-x.x)/r,y:(N.clientY-x.y)/r})},k=()=>i(!1);return window.addEventListener("mousemove",y),window.addEventListener("mouseup",k),()=>{window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",k)}},[h,x,r,u]),s.jsxs("g",{transform:`translate(${t.position.x}, ${t.position.y})`,onMouseDown:v,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),style:{cursor:h?"grabbing":"grab"},children:[(n||e)&&s.jsx("circle",{r:t.size+8,fill:"none",stroke:g,strokeWidth:2,strokeOpacity:.3,className:"animate-pulse"}),s.jsx("circle",{r:t.size,fill:`${g}20`,stroke:g,strokeWidth:n?3:2,style:{filter:n?`drop-shadow(0 0 10px ${g})`:"none"}}),t.isTracking&&s.jsx("circle",{r:t.size+4,fill:"none",stroke:"#00FF88",strokeWidth:2,strokeDasharray:"4 4",className:"animate-spin",style:{animationDuration:"10s"}}),t.isExpanding&&s.jsx("g",{children:s.jsxs("circle",{r:t.size+6,fill:"none",stroke:g,strokeWidth:2,strokeOpacity:.5,children:[s.jsx("animate",{attributeName:"r",from:t.size,to:t.size+20,dur:"1s",repeatCount:"indefinite"}),s.jsx("animate",{attributeName:"stroke-opacity",from:"0.8",to:"0",dur:"1s",repeatCount:"indefinite"})]})}),t.source&&s.jsx("circle",{cx:t.size*.7,cy:-t.size*.7,r:8,fill:w,stroke:"#0F172A",strokeWidth:2}),t.isRoot&&s.jsx("circle",{cx:-t.size*.7,cy:-t.size*.7,r:6,fill:"#FFD700",stroke:"#0F172A",strokeWidth:2}),s.jsx("text",{y:4,textAnchor:"middle",fill:"white",fontSize:t.size>40?12:10,fontWeight:"500",style:{pointerEvents:"none",userSelect:"none"},children:t.label.length>15?`${t.label.slice(0,15)}...`:t.label}),e&&!h&&s.jsxs("g",{transform:`translate(0, ${t.size+20})`,children:[s.jsx("rect",{x:-60,y:-10,width:120,height:28,rx:4,fill:"#1E293B",stroke:"#334155"}),s.jsxs("g",{transform:"translate(-40, 0)",onClick:y=>{y.stopPropagation(),p()},style:{cursor:"pointer"},children:[s.jsx("circle",{r:10,fill:"#8B5CF620",stroke:"#8B5CF6"}),s.jsx(V,{x:-5,y:-5,width:10,height:10,color:"#8B5CF6"})]}),s.jsxs("g",{transform:"translate(0, 0)",onClick:y=>{y.stopPropagation(),d()},style:{cursor:"pointer"},children:[s.jsx("circle",{r:10,fill:t.isTracking?"#00FF8820":"#33415520",stroke:t.isTracking?"#00FF88":"#334155"}),s.jsx(je,{x:-5,y:-5,width:10,height:10,color:t.isTracking?"#00FF88":"#64748B"})]}),s.jsxs("g",{transform:"translate(40, 0)",onClick:y=>{y.stopPropagation(),l()},style:{cursor:"pointer"},children:[s.jsx("circle",{r:10,fill:"#EF444420",stroke:"#EF4444"}),s.jsx(U,{x:-5,y:-5,width:10,height:10,color:"#EF4444"})]})]})]})},We=({edge:t,sourceNode:n,targetNode:e,isSelected:r})=>{const o=Ce[t.type]||"#6B7280",a=e.position.x-n.position.x,u=e.position.y-n.position.y,p=Math.sqrt(a*a+u*u),l=(n.position.x+e.position.x)/2,d=(n.position.y+e.position.y)/2,h=-u/p,i=a/p,x=Math.min(p*.15,40),m=l+h*x,g=d+i*x,w=Math.atan2(u,a),v=n.position.x+Math.cos(w)*n.size,y=n.position.y+Math.sin(w)*n.size,k=e.position.x-Math.cos(w)*e.size,N=e.position.y-Math.sin(w)*e.size,C=`M ${v} ${y} Q ${m} ${g} ${k} ${N}`;return s.jsxs("g",{children:[s.jsx("path",{d:C,fill:"none",stroke:o,strokeWidth:4*t.weight,strokeOpacity:.1}),s.jsx("path",{d:C,fill:"none",stroke:o,strokeWidth:2*t.weight,strokeOpacity:r?.8:.5,markerEnd:"url(#arrowhead)"}),t.animated&&s.jsx("path",{d:C,fill:"none",stroke:o,strokeWidth:1,strokeDasharray:"6 6",strokeOpacity:.6,children:s.jsx("animate",{attributeName:"stroke-dashoffset",from:"0",to:"-24",dur:"1s",repeatCount:"indefinite"})}),t.label&&s.jsx("text",{x:m,y:g-8,textAnchor:"middle",fill:"rgba(255,255,255,0.5)",fontSize:9,children:t.label})]})},Ue=()=>{const t=S.useRef(null),[n,e]=S.useState(!1),[r,o]=S.useState({x:0,y:0}),[a,u]=S.useState(!1),{nodes:p,edges:l,selectedNodeId:d,hoveredNodeId:h,viewport:i,isSearching:x,searchQuery:m,autoTrackEnabled:g,setSearchQuery:w,setSearching:v,addNodeFromSearch:y,removeNode:k,moveNode:N,selectNode:C,hoverNode:Q,setNodeExpanding:$,toggleNodeTracking:Z,expandNode:P,setViewport:W,setZoom:_,resetViewport:K,applyForceLayout:G,applyRadialLayout:q,setAutoTrack:ee,undo:T,redo:z,clear:te}=Me(),se=async c=>{if(c.preventDefault(),!!m.trim()){v(!0);try{const f=F.filter(I=>I.enabled).map(I=>I.type),b=await R(m.trim(),f,5),j=b.length>0?`Fundet ${b.length} resultater i dine data`:void 0,E=y(m.trim(),j);b.length>0&&console.log(`[MindMap] Found ${b.length} results for "${m}"`)}catch(f){console.error("Search error:",f),y(m.trim())}finally{v(!1)}}},re=async c=>{const f=p.find(b=>b.id===c);if(!(!f||f.isExpanding)){$(c,!0);try{const b=F.filter(E=>E.enabled).map(E=>E.type),j=await Te(f,b);if(j.nodes.length>0){const E=j.edges.map(I=>({...I,sourceId:c}));P(c,j.nodes,E)}else{const E=await R(f.label,b,3);if(E.length>0){const I=E.map(D=>({label:D.title.slice(0,30),description:D.snippet,type:"expanded",source:D.source,sourceUrl:D.url,size:35,color:M.expanded})),ne=I.map(()=>({sourceId:c,targetId:"",type:"relates_to",weight:.6,animated:!0}));P(c,I,ne)}else $(c,!1),console.warn("No expansion results found")}}catch(b){console.error("Expansion error:",b),$(c,!1)}}};S.useEffect(()=>{const c=t.current;if(!c)return;const f=b=>{b.preventDefault();const j=b.deltaY>0?-.1:.1;_(i.zoom+j)};return c.addEventListener("wheel",f,{passive:!1}),()=>c.removeEventListener("wheel",f)},[i.zoom,_]);const oe=c=>{(c.target===t.current||c.target.tagName==="svg")&&(e(!0),o({x:c.clientX-i.x,y:c.clientY-i.y}),C(null))};return S.useEffect(()=>{if(!n)return;const c=b=>{W({...i,x:b.clientX-r.x,y:b.clientY-r.y})},f=()=>e(!1);return window.addEventListener("mousemove",c),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",f)}},[n,r,i,W]),S.useEffect(()=>{const c=f=>{f.key==="Delete"&&d&&k(d),f.ctrlKey&&f.key==="z"&&T(),f.ctrlKey&&f.key==="y"&&z(),f.key==="Escape"&&C(null)};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[d,k,T,z,C]),s.jsxs("div",{className:"relative w-full h-full min-h-[600px] bg-slate-950 overflow-hidden",children:[s.jsx("header",{className:"absolute top-0 left-0 right-0 z-30 h-14 border-b border-white/10 bg-black/50 backdrop-blur-xl",children:s.jsxs("div",{className:"h-full px-4 flex items-center justify-between",children:[s.jsxs("form",{onSubmit:se,className:"flex items-center gap-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40"}),s.jsx("input",{type:"text",value:m,onChange:c=>w(c.target.value),placeholder:"SÃ¸g efter emne â†’ bliver til node...",className:"w-80 pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg text-sm text-white placeholder-white/40 focus:outline-none focus:border-cyan-500/50 focus:ring-1 focus:ring-cyan-500/30"})]}),s.jsxs("button",{type:"submit",disabled:!m.trim()||x,className:"px-4 py-2 bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-500/30 rounded-lg text-sm text-cyan-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[x?s.jsx(xe,{className:"w-4 h-4 animate-spin"}):s.jsx(me,{className:"w-4 h-4"}),"TilfÃ¸j Node"]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-xs text-white/40",children:[p.length," nodes Â· ",l.length," edges"]}),s.jsxs("div",{className:"flex items-center gap-1 bg-white/5 rounded-lg p-1",children:[s.jsx("button",{onClick:T,className:"p-1.5 hover:bg-white/10 rounded",title:"Undo (Ctrl+Z)",children:s.jsx(ge,{className:"w-4 h-4 text-white/60"})}),s.jsx("button",{onClick:z,className:"p-1.5 hover:bg-white/10 rounded",title:"Redo (Ctrl+Y)",children:s.jsx(fe,{className:"w-4 h-4 text-white/60"})})]}),s.jsxs("div",{className:"flex items-center gap-1 bg-white/5 rounded-lg p-1",children:[s.jsx("button",{onClick:()=>_(i.zoom-.2),className:"p-1.5 hover:bg-white/10 rounded",children:s.jsx(ye,{className:"w-4 h-4 text-white/60"})}),s.jsxs("span",{className:"text-xs text-white/50 w-12 text-center",children:[Math.round(i.zoom*100),"%"]}),s.jsx("button",{onClick:()=>_(i.zoom+.2),className:"p-1.5 hover:bg-white/10 rounded",children:s.jsx(we,{className:"w-4 h-4 text-white/60"})})]}),s.jsxs("div",{className:"flex items-center gap-1 bg-white/5 rounded-lg p-1",children:[s.jsx("button",{onClick:G,className:"p-1.5 hover:bg-white/10 rounded",title:"Force Layout",children:s.jsx(Y,{className:"w-4 h-4 text-white/60"})}),s.jsx("button",{onClick:q,className:"p-1.5 hover:bg-white/10 rounded",title:"Radial Layout",children:s.jsx(be,{className:"w-4 h-4 text-white/60"})}),s.jsx("button",{onClick:K,className:"p-1.5 hover:bg-white/10 rounded",title:"Reset View",children:s.jsx(ve,{className:"w-4 h-4 text-white/60"})})]}),s.jsxs("button",{onClick:()=>ee(!g),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors ${g?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-white/5 text-white/50 border border-white/10"}`,children:[s.jsx(ke,{className:`w-3.5 h-3.5 ${g?"animate-spin":""}`,style:{animationDuration:"3s"}}),"Auto-Track"]}),s.jsx("button",{onClick:te,className:"p-2 hover:bg-red-500/20 rounded-lg transition-colors group",title:"Clear All",children:s.jsx(U,{className:"w-4 h-4 text-white/40 group-hover:text-red-400"})}),s.jsx("button",{onClick:()=>u(!a),className:`p-2 rounded-lg transition-colors ${a?"bg-cyan-500/20 text-cyan-400":"hover:bg-white/10 text-white/60"}`,title:"Data Sources",children:s.jsx(A,{className:"w-4 h-4"})})]})]})}),a&&s.jsx(Ae,{onClose:()=>u(!1)}),s.jsxs("div",{ref:t,className:"absolute inset-0 top-14",style:{cursor:n?"grabbing":"grab"},onMouseDown:oe,children:[s.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`
              radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.03) 0%, transparent 50%),
              linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px)
            `,backgroundSize:"100% 100%, 40px 40px, 40px 40px",backgroundPosition:`center, ${i.x}px ${i.y}px, ${i.x}px ${i.y}px`}}),s.jsxs("svg",{className:"absolute inset-0",style:{transform:`translate(${i.x}px, ${i.y}px) scale(${i.zoom})`,transformOrigin:"0 0"},width:"2000",height:"1200",children:[s.jsx("defs",{children:s.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:s.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"rgba(255,255,255,0.3)"})})}),l.map(c=>{const f=p.find(j=>j.id===c.sourceId),b=p.find(j=>j.id===c.targetId);return!f||!b?null:s.jsx(We,{edge:c,sourceNode:f,targetNode:b,isSelected:d===c.sourceId||d===c.targetId},c.id)}),p.map(c=>s.jsx(Pe,{node:c,isSelected:c.id===d,isHovered:c.id===h,zoom:i.zoom,onSelect:()=>C(c.id),onHover:f=>Q(f?c.id:null),onMove:f=>N(c.id,f),onExpand:()=>re(c.id),onDelete:()=>k(c.id),onToggleTracking:()=>Z(c.id)},c.id))]}),p.length===0&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-purple-500/10 border border-purple-500/20 flex items-center justify-center",children:s.jsx(Y,{className:"w-10 h-10 text-purple-400"})}),s.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Start din MindMap"}),s.jsxs("p",{className:"text-sm text-white/50 max-w-md",children:["SÃ¸g efter et emne ovenfor. Det bliver din fÃ¸rste node.",s.jsx("br",{}),"Klik pÃ¥ ",s.jsx(V,{className:"inline w-4 h-4 text-purple-400"})," for at lade AI udvide med relaterede emner."]})]})})]}),s.jsxs("div",{className:"absolute bottom-4 left-4 bg-black/60 backdrop-blur-sm rounded-lg border border-white/10 p-3",children:[s.jsx("p",{className:"text-[10px] text-white/40 uppercase tracking-wider mb-2",children:"Node Typer"}),s.jsx("div",{className:"space-y-1.5",children:Object.entries(M).map(([c,f])=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:f}}),s.jsx("span",{className:"text-[10px] text-white/60 capitalize",children:c})]},c))})]}),s.jsxs("div",{className:"absolute bottom-4 right-4 text-[10px] text-white/30 space-y-1",children:[s.jsx("p",{children:"Scroll: Zoom Â· Drag: Pan Â· Del: Slet node"}),s.jsx("p",{children:"Ctrl+Z: Undo Â· Ctrl+Y: Redo Â· Esc: Deselect"})]})]})};export{Ue as MindMapBuilderWidget,Ue as default};
