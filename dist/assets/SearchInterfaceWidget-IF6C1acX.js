import{r as a,j as e}from"./ui-d27jHJxv.js";import{B as u}from"./Button-CUGYQXiP.js";import{b as $,c as U,r as B}from"./securityApi-Bh3J2vfj.js";import"./vendor-BerfLJhL.js";const O=[{id:"tpl-high-severity",name:"High fidelity alerts",description:"Critical events touching finance or executive accounts within 24h.",query:"credential leak finance exec",severity:"critical",timeframe:"24h",sources:["Dark Web","Feed Ingestion"]},{id:"tpl-zero-day",name:"Zero-day exploitation",description:"Vendor advisories mentioning active exploitation or PoC for CVEs.",query:"zero-day vendor advisory exploitation",severity:"medium",timeframe:"7d",sources:["Vendor Radar","CERT-EU"]},{id:"tpl-supply-chain",name:"Supply chain monitoring",description:"Events referencing suppliers or 3rd party SaaS incidents.",query:"supplier breach SaaS incident",severity:"all",timeframe:"30d",sources:["Feed Ingestion","Internal Telemetry"]}],V=[{id:"sr-4031",title:"Dark web actor selling finance leadership credentials",summary:"Marketplace listing with 24 unique accounts incl. CFO and procurement lead.",source:"Feed Ingestion",severity:"critical",timestamp:"2025-11-18T08:18:00Z",tags:["credentials","darkweb","finance"],score:.92},{id:"sr-4024",title:"CVE-2025-1123 exploited in procurement SaaS tenant",summary:"Vendor confirms active exploitation with SQL injection payload hitting EU tenants.",source:"Vendor Radar",severity:"high",timestamp:"2025-11-18T07:58:00Z",tags:["cve-2025-1123","procurement","sql injection"],score:.84},{id:"sr-3988",title:"Suspicious OAuth consent for executive mailbox",summary:"Detected via internal telemetry, unrecognized app requested mail.read and offline_access.",source:"Internal Telemetry",severity:"medium",timestamp:"2025-11-18T07:40:00Z",tags:["oauth","mailbox","delegated access"],score:.79},{id:"sr-3921",title:"Supplier hosting provider outage",summary:"OSINT chatter indicates ransomware event at Tier-2 supplier datacenter.",source:"Feed Ingestion",severity:"high",timestamp:"2025-11-18T06:55:00Z",tags:["supply-chain","ransomware"],score:.73}],b={latencyMs:182,totalDocs:126e3,coverage:.87},z=["Feed Ingestion","Dark Web","Vendor Radar","CERT-EU","Internal Telemetry"],H={low:"bg-emerald-100 text-emerald-700 border-emerald-200",medium:"bg-amber-100 text-amber-700 border-amber-200",high:"bg-orange-100 text-orange-700 border-orange-200",critical:"bg-rose-100 text-rose-700 border-rose-200"},Q=r=>r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),G=()=>{const[r,d]=a.useState(""),[c,f]=a.useState("all"),[o,j]=a.useState("24h"),[x,y]=a.useState(["Feed Ingestion","Dark Web"]),[R,q]=a.useState(O),[m,A]=a.useState(V.slice(0,3)),[h,M]=a.useState(b),[v,p]=a.useState([]),[N,S]=a.useState(!1),[w,k]=a.useState(null),[T,C]=a.useState(null);a.useEffect(()=>{let s=!1;return(async()=>{var t,i;try{const[l,n]=await Promise.all([$(),U(6)]);if(s)return;(t=l.templates)!=null&&t.length&&q(l.templates),(i=n.history)!=null&&i.length&&p(n.history),C(null)}catch(l){console.warn("Security search bootstrap failed",l),s||C("Security services offline; showing cached templates.")}})(),()=>{s=!0}},[]);const E=a.useMemo(()=>r.trim().split(/\s+/).filter(Boolean),[r]),L=s=>{if(E.length===0)return s;const t=new RegExp(`(${E.map(Q).join("|")})`,"gi");return s.split(t).map((l,n)=>l===""?null:n%2===1?e.jsx("mark",{className:"bg-amber-200 text-amber-900 rounded px-0.5",children:l},`${l}-${n}`):e.jsx(a.Fragment,{children:l},`${l}-${n}`))},F=s=>{y(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},I=s=>{d(s.query),f(s.severity),j(s.timeframe),y(s.sources)},D=a.useCallback(async()=>{var s;try{S(!0);const t=await B({query:r,severity:c,timeframe:o,sources:x});A((s=t.results)!=null&&s.length?t.results:[]),M(t.metrics??b),t.auditEntry&&p(i=>[t.auditEntry,...i].slice(0,6)),k(null)}catch(t){console.warn("Security search failed",t),k("Search service unavailable; showing cached data."),p(i=>[{id:`hist-fallback-${Date.now()}`,query:r||"(blank query)",severity:c,timeframe:o,sources:x,results:m.length,latencyMs:b.latencyMs,ranAt:new Date().toISOString()},...i].slice(0,6))}finally{S(!1)}},[r,c,o,x]);return e.jsxs("div",{className:"h-full flex flex-col -m-4","data-testid":"search-interface-widget",children:[e.jsx("header",{className:"p-4 bg-slate-950/85 text-white border-b border-slate-800",children:e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-white/60",children:"Cyberstreams Track 2.B"}),e.jsx("h3",{className:"text-2xl font-semibold",children:"Search Interface · Unified Threat Query"}),e.jsx("p",{className:"text-sm text-white/80",children:"Advanced query builder targeting OpenSearch with saved templates and audit history."})]}),e.jsxs("div",{className:"text-right min-w-[150px]",children:[e.jsx("p",{className:"text-xs text-white/70",children:"Current SLA"}),e.jsxs("p",{className:"text-2xl font-semibold",children:[h.latencyMs," ms"]}),w&&e.jsx("p",{className:"text-xs text-rose-300 mt-1",children:w})]})]})}),e.jsxs("div",{className:"flex-1 grid grid-cols-12 gap-4 p-4 bg-slate-50 dark:bg-slate-900/30 overflow-hidden",children:[e.jsxs("section",{className:"col-span-12 xl:col-span-5 flex flex-col gap-4",children:[e.jsxs("div",{className:"border border-slate-200 dark:border-slate-800 rounded-2xl bg-white dark:bg-slate-900/70 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Query builder"}),e.jsx(u,{variant:"primary",size:"small",onClick:D,"aria-label":"Run query",disabled:N,children:N?"Searching…":"Run query"})]}),e.jsx("label",{className:"text-xs text-slate-600 dark:text-slate-300 mb-1 block",htmlFor:"search-query",children:"Search query"}),e.jsx("textarea",{id:"search-query",value:r,onChange:s=>d(s.target.value),rows:3,className:"w-full rounded-lg border border-slate-200 dark:border-slate-700 px-3 py-2 text-sm bg-white/80 dark:bg-slate-950/40",placeholder:"Example: credential leak finance exec"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-600 dark:text-slate-300 mb-1 block",htmlFor:"severity-select",children:"Severity"}),e.jsxs("select",{id:"severity-select",value:c,onChange:s=>f(s.target.value),className:"w-full rounded-lg border border-slate-200 dark:border-slate-700 px-3 py-2 text-sm bg-white/80 dark:bg-slate-950/40",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-600 dark:text-slate-300 mb-1 block",htmlFor:"timeframe-select",children:"Timeframe"}),e.jsxs("select",{id:"timeframe-select",value:o,onChange:s=>j(s.target.value),className:"w-full rounded-lg border border-slate-200 dark:border-slate-700 px-3 py-2 text-sm bg-white/80 dark:bg-slate-950/40",children:[e.jsx("option",{value:"1h",children:"Last hour"}),e.jsx("option",{value:"6h",children:"Last 6 hours"}),e.jsx("option",{value:"24h",children:"Last 24 hours"}),e.jsx("option",{value:"7d",children:"Last 7 days"}),e.jsx("option",{value:"30d",children:"Last 30 days"})]})]})]}),e.jsxs("fieldset",{className:"mt-4",children:[e.jsx("legend",{className:"text-xs text-slate-600 dark:text-slate-300 mb-2",children:"Sources"}),e.jsx("div",{className:"flex flex-wrap gap-3 text-sm",children:z.map(s=>e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.includes(s),onChange:()=>F(s),"aria-label":`Toggle source ${s}`,className:"ms-focusable"}),s]},s))})]})]}),e.jsxs("div",{className:"border border-slate-200 dark:border-slate-800 rounded-2xl bg-white dark:bg-slate-900/70 p-4 flex-1 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Saved templates"}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Curated by SecOps · WCAG compliant",T&&e.jsx("span",{className:"text-amber-600 ml-2",children:T})]})]}),e.jsx(u,{variant:"subtle",size:"small",children:"Create template"})]}),e.jsx("div",{className:"space-y-3",role:"list",children:R.map(s=>e.jsxs("article",{className:"p-3 border border-slate-100 dark:border-slate-800 rounded-xl",role:"listitem",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.description})]}),e.jsx(u,{variant:"primary",size:"small",onClick:()=>I(s),"aria-label":`Use template: ${s.name}`,children:"Use template"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] mt-2 text-slate-600 dark:text-slate-300",children:[e.jsxs("span",{children:["Severity: ",s.severity]}),e.jsxs("span",{children:["Timeframe: ",s.timeframe]}),e.jsxs("span",{children:["Sources: ",s.sources.join(", ")]})]})]},s.id))})]})]}),e.jsxs("section",{className:"col-span-12 xl:col-span-7 flex flex-col gap-4 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(g,{label:"Documents scanned",value:h.totalDocs.toLocaleString(),helper:"OpenSearch ti-feeds"}),e.jsx(g,{label:"Query latency",value:`${h.latencyMs} ms`,helper:"P95"}),e.jsx(g,{label:"Coverage",value:`${Math.round(h.coverage*100)}%`,helper:"Feeds connected"})]}),e.jsxs("div",{className:"border border-slate-200 dark:border-slate-800 rounded-2xl bg-white dark:bg-slate-900/70 p-4 flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Results"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[m.length," matches"]})]}),e.jsxs("div",{className:"space-y-3 overflow-auto h-full","data-testid":"search-results",children:[m.map(s=>e.jsxs("article",{className:"p-3 border border-slate-100 dark:border-slate-800 rounded-xl","data-testid":"search-result",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs",children:[e.jsx("span",{className:"font-semibold",children:s.id}),e.jsx("span",{children:new Date(s.timestamp).toLocaleString()})]}),e.jsx("p",{className:"text-sm font-semibold mt-1",children:L(s.title)}),e.jsx("p",{className:"text-xs text-slate-500",children:L(s.summary)}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2 text-xs",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full border ${H[s.severity]}`,children:s.severity.toUpperCase()}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-100 dark:bg-slate-800",children:s.source}),e.jsxs("span",{className:"text-slate-500",children:["Score ",Math.round(s.score*100),"%"]}),(s.tags??[]).map(t=>e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-slate-100 dark:bg-slate-800",children:["#",t]},t))]})]},s.id)),m.length===0&&e.jsx("div",{className:"text-sm text-slate-500 border border-dashed border-slate-200 rounded-xl p-6 text-center",children:"No documents matched. Adjust filters or broaden timeframe."})]})]}),e.jsxs("div",{className:"border border-slate-200 dark:border-slate-800 rounded-2xl bg-white dark:bg-slate-900/70 p-4 h-48 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Search history"}),e.jsx(u,{variant:"subtle",size:"small",children:"Export audit log"})]}),e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left font-medium",children:"Time"}),e.jsx("th",{className:"text-left font-medium",children:"Query"}),e.jsx("th",{className:"text-left font-medium",children:"Filters"}),e.jsx("th",{className:"text-left font-medium",children:"Results"}),e.jsx("th",{className:"text-left font-medium",children:"Latency"})]})}),e.jsxs("tbody",{className:"text-slate-700 dark:text-slate-200",children:[v.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"py-2 text-center text-slate-500",colSpan:5,children:"Run a search to populate audit history."})}),v.map(s=>e.jsxs("tr",{"data-testid":"search-history-row",children:[e.jsx("td",{className:"py-1",children:new Date(s.ranAt).toLocaleTimeString()}),e.jsx("td",{className:"py-1",children:s.query}),e.jsxs("td",{className:"py-1",children:[s.severity," · ",s.timeframe," · ",(s.sources??[]).join(", ")]}),e.jsx("td",{className:"py-1",children:s.results}),e.jsxs("td",{className:"py-1",children:[s.latencyMs," ms"]})]},s.id))]})]})]})]})]})]})},g=({label:r,value:d,helper:c})=>e.jsxs("div",{className:"border border-slate-200 dark:border-slate-800 rounded-2xl bg-white dark:bg-slate-900/70 p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:r}),e.jsx("p",{className:"text-2xl font-semibold mt-1",children:d}),c&&e.jsx("p",{className:"text-xs text-slate-400",children:c})]});export{G as default};
