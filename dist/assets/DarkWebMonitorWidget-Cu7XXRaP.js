import{r as s,j as e}from"./ui-d27jHJxv.js";import{B as b}from"./Button-CUGYQXiP.js";import{u as f}from"./useMCP-C6vkw6pp.js";import"./vendor-BerfLJhL.js";const p=s.createContext(null),j=()=>{const r=s.useContext(p);if(!r)throw new Error("useWidgetBridge must be used within WidgetBridgeProvider");return r},i={feeds:[],threats:[],metrics:{totalThreats:0,avgPriceUSD:0,leakVelocity:0,resolutionRate:0}},k={low:"bg-emerald-100 text-emerald-600 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-400 dark:border-emerald-800",medium:"bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/30 dark:text-amber-400 dark:border-amber-800",high:"bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/30 dark:text-orange-400 dark:border-orange-800",critical:"bg-rose-100 text-rose-700 border-rose-200 dark:bg-rose-900/30 dark:text-rose-400 dark:border-rose-800"},E=({widgetId:r})=>{const{reportStatus:o}=j(),{send:c}=f(),[d,m]=s.useState(!1),[a,n]=s.useState(i),[x,g]=s.useState(null),[u,h]=s.useState(null),l=s.useCallback(async()=>{m(!0),g(null);try{const t=await c("agent-orchestrator","widgets.threat.hunt",{target:"company.com",category:"all"});t&&t.data?(n(t.data),h(new Date().toLocaleTimeString())):(n(i),t!=null&&t.message&&console.log(t.message))}catch(t){console.error("Failed to fetch Dark Web data:",t),g("Kunne ikke forbinde til Backend. Tjek at serveren kører."),n(i)}finally{m(!1)}},[c]);return s.useEffect(()=>{l();const t=setInterval(l,3e5);return()=>clearInterval(t)},[l]),s.useEffect(()=>{const t=`Fundet ${a.metrics.totalThreats} trusler.`;o(r,"Dark Web Monitor",t,a)},[a,r,o]),e.jsxs("div",{className:"h-full flex flex-col -m-4","data-testid":"dark-web-monitor-widget",children:[e.jsx("header",{className:"p-4 bg-slate-950/90 text-white border-b border-slate-800",children:e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-emerald-400",children:"LIVE MONITOR"}),d&&e.jsxs("span",{className:"flex h-2 w-2 relative",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-emerald-500"})]})]}),e.jsx("h3",{className:"text-2xl font-semibold",children:"Dark Web Monitor"}),e.jsx("p",{className:"text-sm text-white/80",children:"Real-time Threat Intelligence"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-slate-400",children:["Last updated: ",u||"Never"]}),e.jsx(b,{variant:"subtle",size:"small",onClick:l,disabled:d,children:d?"Scanning...":"Refresh"})]})]})}),e.jsx("div",{className:"flex-1 p-4 bg-slate-50 dark:bg-slate-900/30 overflow-hidden",children:x?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-red-400",children:[e.jsx("p",{className:"font-bold",children:"Forbindelsesfejl"}),e.jsx("p",{className:"text-sm",children:x}),e.jsx(b,{className:"mt-4",onClick:l,children:"Prøv igen"})]}):a.metrics.totalThreats===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-500",children:[e.jsx("p",{className:"text-lg font-medium",children:"Ingen trusler fundet"}),e.jsx("p",{className:"text-sm",children:"Eller backend scraper har ikke kørt endnu."})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{className:"p-4 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("h4",{className:"font-bold mb-2",children:"Aktive Trusler"}),a.threats.map(t=>e.jsxs("div",{className:"mb-2 p-2 bg-slate-50 dark:bg-slate-900 rounded",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:t.title}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${k[t.severity]}`,children:t.severity})]}),e.jsx("p",{className:"text-xs text-slate-500",children:t.description})]},t.id))]})})})]})};export{E as default};
