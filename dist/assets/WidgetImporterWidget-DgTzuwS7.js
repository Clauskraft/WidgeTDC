import{j as e,L as R,r as n}from"./ui-d27jHJxv.js";import{a as D}from"./index-D3cQhnRP.js";import{B as h}from"./Button-CUGYQXiP.js";import"./vendor-BerfLJhL.js";import"./grid-B9N6NCa2.js";const m=({label:r,children:s})=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1",children:r}),e.jsx("div",{className:"text-gray-800 dark:text-gray-200",children:s})]}),A=({widget:r})=>{var s;return e.jsxs("div",{className:"h-full flex flex-col -m-4",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold",children:r.displayName}),e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:"Microsoft"})]}),e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto space-y-4 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(m,{label:"Size",children:e.jsx("p",{className:"capitalize",children:r.size||"Ukendt"})}),r.detectionSource&&e.jsx(m,{label:"Detection Source",children:e.jsx("p",{className:"capitalize",children:r.detectionSource})}),e.jsx(m,{label:"Widget ID",children:e.jsx("p",{className:"font-mono text-xs break-all",children:r.id})})]}),((s=r.dataSource)==null?void 0:s.url)&&e.jsx(m,{label:"Data Source",children:e.jsx("a",{href:r.dataSource.url,target:"_blank",rel:"noopener noreferrer",className:"ms-focusable text-blue-500 hover:underline break-all",children:r.dataSource.url})}),e.jsx(m,{label:"Capabilities",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:r.capabilities.length>0?r.capabilities.map(a=>e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-gray-200 text-gray-700 dark:bg-gray-600 dark:text-gray-200 capitalize",children:a},a)):e.jsx("span",{className:"text-xs italic text-gray-500",children:"Ingen specificeret"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:"Template Preview"}),e.jsx("pre",{className:"p-3 text-xs bg-gray-100 dark:bg-gray-900 rounded-md overflow-x-auto max-h-40 border border-gray-200 dark:border-gray-700",children:e.jsx("code",{children:JSON.stringify(r.template,null,2)})})]})]})]})};class T{transformToWidgetDefinition(s){const a=`Transformed-${s.id.replace(/[^a-zA-Z0-9]/g,"")}`,i=({widgetId:x})=>R.createElement(A,{widget:s,widgetId:x});return i.displayName=`TransformedWidget(${s.displayName})`,{id:a,name:`(MS) ${s.displayName}`,component:i,defaultLayout:{w:5,h:6},source:"microsoft",category:"system",msWidgetData:s}}}const y=class y{static async detectInstalledWidgets(){console.log("Scanning system for Microsoft widgets (simplified)..."),await new Promise(i=>setTimeout(i,500));const s=[this.scanRegistry()];return(await Promise.all(s)).filter(i=>i.widgets.length>0)}static async scanRegistry(){return{widgets:[{id:"ms-weather",displayName:"Vejr",template:this.getWeatherTemplate(),capabilities:["location","weather"],size:"medium"},{id:"ms-news",displayName:"Nyheder",template:this.getNewsTemplate(),capabilities:["news"],size:"large"}],source:"registry",confidence:.8}}static getWeatherTemplate(){return{type:"AdaptiveCard",version:"1.5",body:[{type:"TextBlock",text:"Vejr",size:"Large",weight:"Bolder"}]}}static getNewsTemplate(){return{type:"AdaptiveCard",version:"1.5",body:[{type:"TextBlock",text:"Seneste Nyheder",size:"Large",weight:"Bolder"}]}}};y.MS_WIDGETS_REGISTRY_PATH="HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Widgets";let f=y;const B={id:"SalesTracker-v1",displayName:"Kvartalsvis Salg",template:{type:"AdaptiveCard",version:"1.5",body:[{type:"TextBlock",text:"Salgs-dashboard",weight:"Bolder",size:"Medium"}]},dataSource:{url:"https://api.contoso.com/sales/quarterly"},capabilities:["interactive","data-driven"]},L=()=>{const{registerWidget:r,availableWidgets:s}=D(),[a,i]=n.useState("importer"),[g,x]=n.useState(JSON.stringify(B,null,2)),[p,j]=n.useState(""),[u,N]=n.useState(""),[k,v]=n.useState(!1),[S,w]=n.useState([]),[W,b]=n.useState(""),z=()=>{try{j(""),N("");const t=JSON.parse(g);if(!t.id||!t.displayName||!t.template)throw new Error("Ugyldigt JSON format. 'id', 'displayName', og 'template' er påkrævet.");I(t,l=>{N(l)})}catch(t){j(`Fejl ved transformation: ${t.message}`)}},I=(t,l)=>{const d=new T().transformToWidgetDefinition(t);if(s.some(c=>c.id===d.id)){l(`Widget'en "${d.name}" er allerede importeret.`);return}r(d),l(`Widget'en "${d.name}" er blevet tilføjet til sidebaren og er klar til brug.`)},E=async()=>{v(!0),b(""),w([]);try{const l=(await f.detectInstalledWidgets()).flatMap(o=>o.widgets.map(d=>({...d,detectionSource:o.source})));l.length===0?b("Ingen widgets fundet på systemet."):w(l)}catch{b("Kunne ikke scanne efter widgets. Denne funktion er muligvis kun tilgængelig i en desktop-app.")}finally{v(!1)}},M=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[e.jsx("label",{htmlFor:"ms-widget-json",className:"font-semibold",children:"Indsæt Microsoft Widget JSON"}),e.jsx("textarea",{id:"ms-widget-json",value:g,onChange:t=>x(t.target.value),className:"ms-focusable w-full flex-1 p-2 rounded-lg border bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-600 resize-none font-mono text-xs"})]}),(p||u)&&e.jsxs("div",{className:"pt-2",children:[p&&e.jsx("div",{className:"p-3 text-sm rounded-lg bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200",children:p}),u&&e.jsxs("div",{className:"p-3 text-sm rounded-lg bg-green-50 dark:bg-green-900/50 border border-green-200 dark:border-green-800 text-green-800 dark:text-green-200",children:[e.jsx("p",{className:"font-bold",children:"Success!"}),e.jsx("p",{children:u})]})]})]}),C=()=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(h,{onClick:E,disabled:k,children:k?"Scanner...":"Scan efter Installerede Widgets"}),W&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:W}),S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Fundne Widgets:"}),S.map(t=>{const o=new T().transformToWidgetDefinition(t),d=s.some(c=>c.id===o.id);return e.jsxs("div",{className:"p-3 flex items-center justify-between rounded-lg bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.displayName}),t.detectionSource&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Fundet i: ",t.detectionSource]})]}),e.jsx(h,{size:"small",disabled:d,onClick:()=>I(t,c=>alert(c)),children:d?"Importeret":"Importér"})]},t.id)})]})]});return e.jsxs("div",{className:"h-full flex flex-col -m-4",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>i("importer"),className:`flex-1 p-2 rounded-md text-sm font-semibold transition-colors ${a==="importer"?"bg-white dark:bg-gray-700 shadow-sm":"hover:bg-gray-200 dark:hover:bg-gray-700/50"}`,children:"Manuel Import"}),e.jsx("button",{onClick:()=>i("detector"),className:`flex-1 p-2 rounded-md text-sm font-semibold transition-colors ${a==="detector"?"bg-white dark:bg-gray-700 shadow-sm":"hover:bg-gray-200 dark:hover:bg-gray-700/50"}`,children:"Auto-detektér"})]})}),e.jsx("div",{className:"flex-1 p-4 flex flex-col gap-4 overflow-y-auto",children:a==="importer"?M():C()}),a==="importer"&&e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx(h,{onClick:z,className:"w-full",children:"Importér og Registrér Widget"})})]})};export{L as default};
