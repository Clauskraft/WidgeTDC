import{r as f,j as e,ah as Q,ag as q,ai as J,a7 as ee,aj as te,ak as se,T as Y,F as ie,c as F,al as ne,af as re,O as ae,am as oe,ac as ce,ad as le,an as de,x as xe,w as me,ao as he,R as pe}from"./ui-d27jHJxv.js";import{c as ue,p as ge,b as be}from"./index-D3cQhnRP.js";import"./vendor-BerfLJhL.js";import"./grid-B9N6NCa2.js";const fe={incidentId:"INC-4711",threatVector:"FIN-DB Lateral Movement",attackerProfile:"APT-29 / Cozy Bear indicators",riskScore:91,arrExposure:245e5,detectedAt:"2025-01-15T06:32:00Z",status:"escalated",graphNodes:[{id:"fin-db-02",label:"FIN-DB-02",type:"compromised",risk:"critical"},{id:"admin-acc",label:"Admin-konto (outsourcet)",type:"account",risk:"critical"},{id:"soc-svc",label:"SOC as a Service",type:"service",risk:"high"},{id:"jump-srv",label:"Jump Server EU-West",type:"server",risk:"medium"},{id:"ext-ip",label:"185.xx.xx.xx (TOR Exit)",type:"external",risk:"critical"}],indicators:[{type:"ip",value:"185.xxx.xxx.xxx",confidence:94},{type:"hash",value:"a3f2b8c...",confidence:87},{type:"domain",value:"cdn-update.*.com",confidence:72},{type:"cve",value:"CVE-2025-0024",confidence:98}]},we={contractId:"CTR-RX-2023-001",customerName:"Region X",arrValue:245e5,currency:"DKK",regulatoryFrameworks:[{id:"dpa",name:"DPA (Databehandleraftale)",status:"compliant"},{id:"nis2",name:"NIS2 Annex II",status:"partial",deadline:"2025-02-01"},{id:"cloud-res",name:"Cloud Residency (EU/EØS)",status:"compliant"},{id:"gdpr-32",name:"GDPR Art. 32",status:"compliant"}],keyClause:"Klausul om dataplacering: Ingen behandling af persondata må ske udenfor EU/EØS uden forudgående skriftlig godkendelse fra Region X.",clauseReference:"§4.3 Dataplacering & Sovereignty",expirationDate:"2026-12-31"},ye={decisionId:"DEC-4711-001",owner:"SVP AI Cloud & Cyber",customerContext:"Kritisk kunde · NIS2 · Sundhedssektor",status:"pending",deadline:"2025-01-15T14:00:00Z",financialImpact:{arrAtRisk:245e5,potentialPenalty:5e6,currency:"DKK"},actions:[{id:"action-1",priority:1,description:"Skift midlertidigt til 100% lokal model for al behandling af Region X-data",deadline:"2025-01-15T10:00:00Z",status:"in_progress"},{id:"action-2",priority:2,description:"Varsl DPA og Region X inden kl. 14:00 med foreløbig rapport",deadline:"2025-01-15T14:00:00Z",status:"pending"},{id:"action-3",priority:3,description:"Freeze udrulning af ny feature i Region X-miljøet",deadline:"2025-01-15T12:00:00Z",status:"completed"}],boardConfirmation:!1},Ne=[{id:"node-threat-rx",type:"threat",position:{x:100,y:150},size:{width:420,height:380},title:"Threat Hunt: Region X",subtitle:"FIN-DB Lateral Movement",severity:"critical",widgetType:"CybersecurityOverwatchWidget",metadata:{...fe,headerBadge:"Kritisk kunde · NIS2"}},{id:"node-contract-rx",type:"contract",position:{x:580,y:100},size:{width:380,height:320},title:"Contract View: Rammeaftale",subtitle:"Region X",severity:"high",widgetType:"ProcurementIntelligenceWidget",metadata:{...we,headerBadge:"DPA, NIS2 Annex, Cloud Residency"}},{id:"node-decision-rx",type:"decision",position:{x:340,y:550},size:{width:400,height:350},title:"Decision: Region X",subtitle:"Incident 4711 (SVP Ansvar)",severity:"critical",widgetType:"CmaDecisionWidget",metadata:{...ye,headerBadge:"SVP AI Cloud & Cyber"}},{id:"node-darkweb-rx",type:"widget",position:{x:1020,y:200},size:{width:320,height:280},title:"Dark Web Intel",subtitle:"Region X credentials",severity:"high",collapsed:!0,widgetType:"DarkWebMonitorWidget",metadata:{monitoredDomains:["region-x.dk","sundhed.region-x.dk"],alertsCount:3}},{id:"node-compliance-rx",type:"widget",position:{x:1020,y:520},size:{width:320,height:240},title:"SRAG Governance",subtitle:"NIS2 Compliance Status",severity:"medium",collapsed:!0,widgetType:"SragGovernanceWidget",metadata:{framework:"NIS2",customer:"Region X"}}],ve=[{id:"conn-threat-contract",sourceId:"node-threat-rx",targetId:"node-contract-rx",connectionType:"regulatory",label:"Hændelsen ligger under denne aftale",svpBudskab:"Den konkrete aktivitet her (peg på graf) er reguleret af præcis den klausul her (peg på kontrakt).",style:"solid",color:"#F59E0B"},{id:"conn-threat-decision",sourceId:"node-threat-rx",targetId:"node-decision-rx",connectionType:"causal",label:"Beslutning afledt af hændelsen",svpBudskab:"Dette er ikke mavefornemmelse – det er en konsekvens af databilledet + kontraktbilledet, som leder til denne beslutning.",style:"solid",color:"#EF4444"},{id:"conn-contract-decision",sourceId:"node-contract-rx",targetId:"node-decision-rx",connectionType:"financial",label:"Kontraktuelle forpligtelser",svpBudskab:"Vores handlingsrum er defineret af disse klausuler og den økonomiske eksponering.",style:"dashed",color:"#3B82F6"},{id:"conn-darkweb-threat",sourceId:"node-darkweb-rx",targetId:"node-threat-rx",connectionType:"operational",label:"Intel understøtter trussel",style:"dashed",color:"#8B5CF6"},{id:"conn-compliance-contract",sourceId:"node-compliance-rx",targetId:"node-contract-rx",connectionType:"regulatory",label:"NIS2 krav i aftalen",style:"dashed",color:"#10B981"}],je=[{id:"cluster-region-x-nis2",name:"Region X - NIS2 Incident Cluster",description:"Kritisk hændelse med lateral movement i FIN-DB. NIS2 og DPA-krav aktiveret.",nodes:["node-threat-rx","node-contract-rx","node-decision-rx","node-darkweb-rx","node-compliance-rx"],connections:["conn-threat-contract","conn-threat-decision","conn-contract-decision","conn-darkweb-threat","conn-compliance-contract"],centerPosition:{x:550,y:400},severity:"critical",owner:"SVP AI Cloud & Cyber",tags:["NIS2","Region X","FIN-DB","Lateral Movement","DPA"]}],ke=[{id:"cluster-pharma-gdpr",name:"Pharma Corp - GDPR Breach",description:"Potentielt databrud med kliniske forsøgsdata.",nodes:[],connections:[],centerPosition:{x:1500,y:200},severity:"high",owner:"SVP AI Cloud & Cyber",tags:["GDPR","Pharma","Clinical Data"]},{id:"cluster-bank-sox",name:"Nordic Bank - SOX Audit",description:"SOX compliance audit Q1 forberedelse.",nodes:[],connections:[],centerPosition:{x:1500,y:600},severity:"medium",owner:"VP Compliance",tags:["SOX","Financial","Audit"]},{id:"cluster-telecom-5g",name:"Telecom Alpha - 5G Security",description:"5G core network penetration test findings.",nodes:[],connections:[],centerPosition:{x:100,y:800},severity:"medium",owner:"CISO",tags:["5G","Telecom","PenTest"]},{id:"cluster-energy-nis2",name:"Energy Corp - NIS2 Migration",description:"NIS2 compliance deadline approaching.",nodes:[],connections:[],centerPosition:{x:800,y:900},severity:"low",owner:"VP Infrastructure",tags:["NIS2","Energy","Migration"]}],B={viewport:{zoom:1,pan:{x:0,y:0},mode:"crisis"},nodes:Ne,connections:ve,clusters:[...je,...ke],selectedNodeId:void 0,selectedConnectionId:void 0,hoveredNodeId:void 0,presentationMode:!1,showMinimap:!0},Ce={totalArrAtRisk:895e5,criticalIncidents:2,pendingDecisions:5,complianceScore:87},A=ue()(ge((t,r)=>({...B,setZoom:s=>t(i=>({viewport:{...i.viewport,zoom:Math.max(.1,Math.min(3,s))}})),setPan:s=>t(i=>({viewport:{...i.viewport,pan:s}})),setViewportMode:s=>t(i=>({viewport:{...i.viewport,mode:s}})),resetViewport:()=>t({viewport:{zoom:1,pan:{x:0,y:0},mode:"crisis"}}),addNode:s=>t(i=>({nodes:[...i.nodes,s]})),updateNode:(s,i)=>t(l=>({nodes:l.nodes.map(x=>x.id===s?{...x,...i}:x)})),removeNode:s=>t(i=>({nodes:i.nodes.filter(l=>l.id!==s),connections:i.connections.filter(l=>l.sourceId!==s&&l.targetId!==s),selectedNodeId:i.selectedNodeId===s?void 0:i.selectedNodeId})),moveNode:(s,i)=>t(l=>({nodes:l.nodes.map(x=>x.id===s?{...x,position:i}:x)})),toggleNodeCollapse:s=>t(i=>({nodes:i.nodes.map(l=>l.id===s?{...l,collapsed:!l.collapsed}:l)})),selectNode:s=>t({selectedNodeId:s,selectedConnectionId:void 0}),hoverNode:s=>t({hoveredNodeId:s}),addConnection:s=>t(i=>({connections:[...i.connections,s]})),updateConnection:(s,i)=>t(l=>({connections:l.connections.map(x=>x.id===s?{...x,...i}:x)})),removeConnection:s=>t(i=>({connections:i.connections.filter(l=>l.id!==s),selectedConnectionId:i.selectedConnectionId===s?void 0:i.selectedConnectionId})),selectConnection:s=>t({selectedConnectionId:s,selectedNodeId:void 0}),addCluster:s=>t(i=>({clusters:[...i.clusters,s]})),updateCluster:(s,i)=>t(l=>({clusters:l.clusters.map(x=>x.id===s?{...x,...i}:x)})),removeCluster:s=>t(i=>({clusters:i.clusters.filter(l=>l.id!==s)})),focusCluster:s=>{const i=r().clusters.find(l=>l.id===s);i&&t({viewport:{zoom:1,pan:{x:-i.centerPosition.x+500,y:-i.centerPosition.y+300},mode:"crisis"}})},togglePresentationMode:()=>t(s=>({presentationMode:!s.presentationMode})),toggleMinimap:()=>t(s=>({showMinimap:!s.showMinimap})),loadState:s=>t(i=>({...i,...s})),resetToDefault:()=>t(B)}),{name:"executive-risk-canvas",partialize:t=>({viewport:t.viewport,nodes:t.nodes,connections:t.connections,clusters:t.clusters,showMinimap:t.showMinimap})})),Ie=()=>A(t=>t.viewport),Me=()=>A(t=>t.nodes),Se=()=>A(t=>t.connections),Ee=()=>A(t=>t.clusters),Ae={critical:{bg:"bg-rose-950/40",border:"border-rose-500/50",badge:"bg-rose-500"},high:{bg:"bg-orange-950/40",border:"border-orange-500/50",badge:"bg-orange-500"},medium:{bg:"bg-amber-950/40",border:"border-amber-500/50",badge:"bg-amber-500"},low:{bg:"bg-emerald-950/40",border:"border-emerald-500/50",badge:"bg-emerald-500"}},Te={threat:e.jsx(F,{className:"w-4 h-4"}),contract:e.jsx(ie,{className:"w-4 h-4"}),decision:e.jsx(Y,{className:"w-4 h-4"}),policy:e.jsx(se,{className:"w-4 h-4"}),widget:e.jsx(te,{className:"w-4 h-4"})},De={threat:"Threat Hunt",contract:"Contract View",decision:"Decision Card",policy:"Policy",widget:"Widget"},Pe=({node:t,isSelected:r,isHovered:s,zoom:i,onSelect:l,onHover:x,onMove:j,onToggleCollapse:n,onRemove:w,widgetComponent:y})=>{var u;const a=f.useRef(null),g=f.useRef(null),v=t.severity||"medium",c=Ae[v],m=f.useCallback(d=>{d.preventDefault(),d.stopPropagation(),g.current={startX:d.clientX,startY:d.clientY,nodeX:t.position.x,nodeY:t.position.y};const h=k=>{if(!g.current)return;const I=(k.clientX-g.current.startX)/i,M=(k.clientY-g.current.startY)/i;j({x:g.current.nodeX+I,y:g.current.nodeY+M})},N=()=>{g.current=null,window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",N)};window.addEventListener("mousemove",h),window.addEventListener("mouseup",N)},[t.position,i,j]),p=(u=t.metadata)==null?void 0:u.headerBadge;return e.jsxs("div",{ref:a,className:`
        absolute rounded-xl backdrop-blur-md shadow-2xl overflow-hidden
        transition-all duration-200 ease-out
        ${c.bg} ${c.border} border-2
        ${r?"ring-2 ring-white/30 shadow-[0_0_30px_rgba(255,255,255,0.1)]":""}
        ${s?"shadow-[0_0_20px_rgba(255,255,255,0.05)]":""}
        ${t.collapsed?"cursor-pointer":""}
      `,style:{left:t.position.x,top:t.position.y,width:t.collapsed?280:t.size.width,height:t.collapsed?60:t.size.height,transform:`scale(${r?1.02:1})`,zIndex:r?100:s?50:10},onClick:d=>{d.stopPropagation(),l(),t.collapsed&&n()},onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-black/20 border-b border-white/10 cursor-grab active:cursor-grabbing",onMouseDown:m,children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Q,{className:"w-4 h-4 text-white/40 flex-shrink-0"}),e.jsx("div",{className:`p-1 rounded ${c.badge} flex-shrink-0`,children:Te[t.type]}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-white/70 uppercase tracking-wider",children:De[t.type]}),p&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-white/10 rounded text-white/60 truncate max-w-[120px]",children:p})]}),e.jsx("h3",{className:"text-sm font-semibold text-white truncate",children:t.title})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-bold uppercase ${c.badge} text-white`,children:v}),e.jsx("button",{onClick:d=>{d.stopPropagation(),n()},className:"p-1 hover:bg-white/10 rounded transition-colors",children:t.collapsed?e.jsx(q,{className:"w-3.5 h-3.5 text-white/60"}):e.jsx(J,{className:"w-3.5 h-3.5 text-white/60"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),w()},className:"p-1 hover:bg-red-500/20 rounded transition-colors",children:e.jsx(ee,{className:"w-3.5 h-3.5 text-white/60 hover:text-red-400"})})]})]}),!t.collapsed&&e.jsx("div",{className:"flex-1 overflow-hidden",style:{height:t.size.height-52},children:y?e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-full flex items-center justify-center text-white/40",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs",children:"Loading widget..."})]})}),children:e.jsx(y,{widgetId:t.id,config:t.metadata,compact:!0})}):e.jsx(Re,{node:t})}),t.collapsed&&t.subtitle&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 px-3 py-1 text-xs text-white/50 truncate",children:t.subtitle})]})},Re=({node:t})=>{const r=t.metadata||{};return t.type==="threat"?e.jsxs("div",{className:"p-3 space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Risk Score"}),e.jsx("span",{className:"font-bold text-rose-400",children:r.riskScore||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"ARR Exposure"}),e.jsx("span",{className:"font-bold text-white",children:r.arrExposure?`${(r.arrExposure/1e6).toFixed(1)} mio DKK`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Status"}),e.jsx("span",{className:`font-medium ${r.status==="escalated"?"text-rose-400":r.status==="investigating"?"text-amber-400":"text-emerald-400"}`,children:r.status||"Unknown"})]}),r.graphNodes&&Array.isArray(r.graphNodes)&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-white/10",children:[e.jsx("span",{className:"text-xs text-white/40 uppercase",children:"Attack Graph Nodes"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:r.graphNodes.slice(0,4).map((s,i)=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-white/10 rounded",children:s.label},i))})]})]}):t.type==="contract"?e.jsxs("div",{className:"p-3 space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"ARR Value"}),e.jsx("span",{className:"font-bold text-white",children:r.arrValue?`${(r.arrValue/1e6).toFixed(1)} mio ${r.currency||"DKK"}`:"N/A"})]}),r.keyClause&&e.jsxs("div",{className:"p-2 bg-white/5 rounded border border-white/10",children:[e.jsx("span",{className:"text-xs text-white/40 block mb-1",children:r.clauseReference||"Key Clause"}),e.jsxs("p",{className:"text-xs text-white/80 italic line-clamp-3",children:['"',r.keyClause,'"']})]}),r.regulatoryFrameworks&&Array.isArray(r.regulatoryFrameworks)&&e.jsx("div",{className:"flex flex-wrap gap-1",children:r.regulatoryFrameworks.map((s,i)=>e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${s.status==="compliant"?"bg-emerald-500/20 text-emerald-400":s.status==="partial"?"bg-amber-500/20 text-amber-400":"bg-rose-500/20 text-rose-400"}`,children:s.name},i))})]}):t.type==="decision"?e.jsxs("div",{className:"p-3 space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-white/60",children:"Owner"}),e.jsx("span",{className:"font-medium text-cyan-400",children:r.owner||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Status"}),e.jsx("span",{className:`font-bold uppercase text-xs px-2 py-0.5 rounded ${r.status==="pending"?"bg-amber-500/20 text-amber-400":r.status==="approved"?"bg-emerald-500/20 text-emerald-400":r.status==="rejected"?"bg-rose-500/20 text-rose-400":"bg-purple-500/20 text-purple-400"}`,children:r.status||"Unknown"})]}),r.actions&&Array.isArray(r.actions)&&e.jsxs("div",{className:"space-y-1.5 mt-2 pt-2 border-t border-white/10",children:[e.jsx("span",{className:"text-xs text-white/40 uppercase",children:"Required Actions"}),r.actions.slice(0,3).map((s,i)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:`w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 ${s.status==="completed"?"bg-emerald-500":s.status==="in_progress"?"bg-amber-500":"bg-white/20"}`,children:s.priority}),e.jsx("span",{className:"text-white/70 line-clamp-2",children:s.description})]},i))]})]}):e.jsx("div",{className:"p-3 h-full flex items-center justify-center text-white/40",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-xs",children:"Widget content preview"})]})})},ze={causal:"#EF4444",regulatory:"#F59E0B",financial:"#3B82F6",operational:"#8B5CF6"},Xe=({connections:t,nodes:r,selectedConnectionId:s,hoveredConnectionId:i,onSelectConnection:l,zoom:x})=>{const j=f.useMemo(()=>t.map(n=>{const w=r.find(S=>S.id===n.sourceId),y=r.find(S=>S.id===n.targetId);if(!w||!y)return null;const a={x:w.position.x+w.size.width/2,y:w.position.y+w.size.height/2},g={x:y.position.x+y.size.width/2,y:y.position.y+y.size.height/2},v=$(w,g),c=$(y,a),m=(v.x+c.x)/2,p=(v.y+c.y)/2,u=c.x-v.x,d=c.y-v.y,h=Math.min(50,Math.sqrt(u*u+d*d)*.2),N=m+(d>0?h:-h),k=p+(u>0?-h:h),I=n.color||ze[n.connectionType],M=n.id===s,C=n.id===i;return{...n,sourceEdge:v,targetEdge:c,controlX:N,controlY:k,midX:m,midY:p,color:I,isSelected:M,isHovered:C}}).filter(Boolean),[t,r,s,i]);return e.jsxs("svg",{className:"absolute inset-0 pointer-events-none",style:{width:"100%",height:"100%",overflow:"visible"},children:[e.jsxs("defs",{children:[e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"currentColor"})}),e.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("pattern",{id:"animated-dash",patternUnits:"userSpaceOnUse",width:"20",height:"1",children:e.jsxs("line",{x1:"0",y1:"0",x2:"10",y2:"0",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("animate",{attributeName:"x1",from:"0",to:"20",dur:"1s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"x2",from:"10",to:"30",dur:"1s",repeatCount:"indefinite"})]})})]}),j.map(n=>{if(!n)return null;const w=n.isSelected?3:n.isHovered?2.5:2,y=n.isSelected||n.isHovered?1:.7;return e.jsxs("g",{className:"pointer-events-auto cursor-pointer",children:[e.jsx("path",{d:`M ${n.sourceEdge.x} ${n.sourceEdge.y} Q ${n.controlX} ${n.controlY} ${n.targetEdge.x} ${n.targetEdge.y}`,fill:"none",stroke:"transparent",strokeWidth:20,onClick:()=>l(n.id)}),e.jsx("path",{d:`M ${n.sourceEdge.x} ${n.sourceEdge.y} Q ${n.controlX} ${n.controlY} ${n.targetEdge.x} ${n.targetEdge.y}`,fill:"none",stroke:n.color,strokeWidth:w,strokeDasharray:n.style==="dashed"||n.style==="animated"?"8,4":"none",opacity:y,markerEnd:"url(#arrowhead)",style:{filter:n.isSelected?"url(#glow)":void 0,color:n.color},children:n.style==="animated"&&e.jsx("animate",{attributeName:"stroke-dashoffset",from:"0",to:"24",dur:"1s",repeatCount:"indefinite"})}),e.jsxs("g",{transform:`translate(${n.midX}, ${n.midY})`,children:[e.jsx("rect",{x:-60,y:-12,width:120,height:24,rx:4,fill:"rgba(15, 23, 42, 0.9)",stroke:n.color,strokeWidth:1,opacity:n.isSelected||n.isHovered?1:.8}),e.jsx("text",{textAnchor:"middle",dominantBaseline:"middle",fontSize:10/x,fill:"white",className:"select-none",children:n.label.length>25?n.label.substring(0,22)+"...":n.label})]}),(n.isSelected||n.isHovered)&&n.svpBudskab&&e.jsxs("g",{transform:`translate(${n.midX}, ${n.midY+30})`,children:[e.jsx("rect",{x:-150,y:0,width:300,height:50,rx:6,fill:"rgba(15, 23, 42, 0.95)",stroke:n.color,strokeWidth:2}),e.jsx("text",{textAnchor:"middle",dominantBaseline:"middle",fontSize:11/x,fill:"#94A3B8",y:15,children:e.jsx("tspan",{x:"0",dy:"0",children:"SVP Budskab:"})}),e.jsxs("text",{textAnchor:"middle",dominantBaseline:"middle",fontSize:10/x,fill:"white",y:35,children:[n.svpBudskab.substring(0,60),"..."]})]})]},n.id)})]})};function $(t,r){const s=t.position.x+t.size.width/2,i=t.position.y+t.size.height/2,l=r.x-s,x=r.y-i,j=t.size.width/2,n=t.size.height/2,w=Math.abs(l)>0?j/Math.abs(l):1/0,y=Math.abs(x)>0?n/Math.abs(x):1/0,a=Math.min(w,y);return{x:s+l*a,y:i+x*a}}const E={critical:"#EF4444",high:"#F97316",medium:"#F59E0B",low:"#10B981"},Be=({nodes:t,clusters:r,viewport:s,canvasSize:i,onNavigate:l})=>{const n=f.useMemo(()=>{if(t.length===0)return{minX:0,minY:0,maxX:2e3,maxY:1500};let c=1/0,m=1/0,p=-1/0,u=-1/0;t.forEach(h=>{c=Math.min(c,h.position.x),m=Math.min(m,h.position.y),p=Math.max(p,h.position.x+h.size.width),u=Math.max(u,h.position.y+h.size.height)});const d=100;return{minX:c-d,minY:m-d,maxX:p+d,maxY:u+d}},[t]),w=n.maxX-n.minX,y=n.maxY-n.minY,a=Math.min(200/w,140/y),g=f.useMemo(()=>{const c=i.width/s.zoom,m=i.height/s.zoom;return{x:(-s.pan.x/s.zoom-n.minX)*a,y:(-s.pan.y/s.zoom-n.minY)*a,width:c*a,height:m*a}},[s,i,n,a]),v=c=>{const m=c.currentTarget.getBoundingClientRect(),p=c.clientX-m.left,u=c.clientY-m.top,d=p/a+n.minX,h=u/a+n.minY;l({x:-d*s.zoom+i.width/2,y:-h*s.zoom+i.height/2})};return e.jsxs("div",{className:"absolute bottom-4 right-4 bg-slate-900/90 backdrop-blur-md rounded-xl border border-white/10 shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-1.5 border-b border-white/10 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-white/70 uppercase tracking-wider",children:"Navigator"}),e.jsxs("span",{className:"text-[10px] text-white/40",children:[Math.round(s.zoom*100),"%"]})]}),e.jsxs("svg",{width:200,height:140,className:"cursor-crosshair",onClick:v,children:[e.jsx("rect",{width:"100%",height:"100%",fill:"#0F172A"}),e.jsx("defs",{children:e.jsx("pattern",{id:"minimap-grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"rgba(255,255,255,0.05)",strokeWidth:"0.5"})})}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#minimap-grid)"}),r.map(c=>{const m=t.filter(N=>c.nodes.includes(N.id));if(m.length===0)return e.jsx("circle",{cx:(c.centerPosition.x-n.minX)*a,cy:(c.centerPosition.y-n.minY)*a,r:15,fill:E[c.severity],fillOpacity:.2,stroke:E[c.severity],strokeWidth:1,strokeOpacity:.5},c.id);let p=1/0,u=1/0,d=-1/0,h=-1/0;return m.forEach(N=>{p=Math.min(p,N.position.x),u=Math.min(u,N.position.y),d=Math.max(d,N.position.x+N.size.width),h=Math.max(h,N.position.y+N.size.height)}),e.jsx("rect",{x:(p-n.minX-20)*a,y:(u-n.minY-20)*a,width:(d-p+40)*a,height:(h-u+40)*a,fill:E[c.severity],fillOpacity:.1,stroke:E[c.severity],strokeWidth:1,strokeOpacity:.3,rx:4},c.id)}),t.map(c=>{const m=(c.position.x-n.minX)*a,p=(c.position.y-n.minY)*a,u=c.size.width*a,d=c.size.height*a,h=E[c.severity||"medium"];return e.jsx("rect",{x:m,y:p,width:Math.max(u,4),height:Math.max(d,3),fill:h,fillOpacity:c.collapsed?.3:.6,stroke:h,strokeWidth:.5,rx:1},c.id)}),e.jsx("rect",{x:Math.max(0,g.x),y:Math.max(0,g.y),width:Math.min(g.width,200-g.x),height:Math.min(g.height,140-g.y),fill:"none",stroke:"#00B5CB",strokeWidth:2,rx:2,className:"pointer-events-none"})]}),e.jsxs("div",{className:"px-3 py-1.5 border-t border-white/10 flex items-center justify-between",children:[e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded ${s.mode==="crisis"?"bg-rose-500/20 text-rose-400":"bg-cyan-500/20 text-cyan-400"}`,children:s.mode==="crisis"?"Crisis View":"Portfolio View"}),e.jsxs("span",{className:"text-[10px] text-white/40",children:[t.length," nodes"]})]})]})},Le=({widgetId:t})=>{const r=f.useRef(null),[s,i]=f.useState({width:1200,height:800}),[l,x]=f.useState(!1),[j,n]=f.useState({x:0,y:0}),[w,y]=f.useState(),a=Ie(),g=Me(),v=Se(),c=Ee(),{setZoom:m,setPan:p,setViewportMode:u,resetViewport:d,moveNode:h,toggleNodeCollapse:N,selectNode:k,hoverNode:I,removeNode:M,selectConnection:C,focusCluster:S,togglePresentationMode:T,toggleMinimap:O,resetToDefault:_,selectedNodeId:L,selectedConnectionId:P,hoveredNodeId:V,presentationMode:z,showMinimap:R}=A();f.useEffect(()=>{const o=()=>{r.current&&i({width:r.current.offsetWidth,height:r.current.offsetHeight})};return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const W=f.useCallback(o=>{o.preventDefault();const b=o.deltaY>0?.9:1.1;m(a.zoom*b)},[a.zoom,m]),H=f.useCallback(o=>{var b;o.button===0&&o.target===((b=r.current)==null?void 0:b.firstChild)&&(x(!0),n({x:o.clientX-a.pan.x,y:o.clientY-a.pan.y}))},[a.pan]),U=f.useCallback(o=>{l&&p({x:o.clientX-j.x,y:o.clientY-j.y})},[l,j,p]),X=f.useCallback(()=>{x(!1)},[]),G=f.useCallback(o=>{var b;o.target===((b=r.current)==null?void 0:b.firstChild)&&(k(void 0),C(void 0))},[k,C]);f.useEffect(()=>{const o=b=>{b.key==="Escape"&&(k(void 0),C(void 0)),(b.key==="+"||b.key==="=")&&m(a.zoom*1.1),b.key==="-"&&m(a.zoom*.9),b.key==="0"&&d(),b.key==="p"&&b.ctrlKey&&(b.preventDefault(),T())};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[a.zoom,m,d,k,C,T]);const K=o=>{if(o)return be[o]},Z=o=>`${(o/1e6).toFixed(1)} mio`,D=Ce;return e.jsxs("div",{className:"h-full flex flex-col bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 -m-4",children:[!z&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/10 bg-black/20 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-cyan-400"}),"Executive Risk Canvas"]}),e.jsx("p",{className:"text-xs text-white/50",children:"SVP AI Cloud & Cyber · Risk & P&L Control Surface"})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-4 ml-6 pl-6 border-l border-white/10",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center gap-1 text-rose-400",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xl font-bold",children:D.criticalIncidents})]}),e.jsx("span",{className:"text-[10px] text-white/40 uppercase",children:"Critical"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center gap-1 text-amber-400",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xl font-bold",children:D.pendingDecisions})]}),e.jsx("span",{className:"text-[10px] text-white/40 uppercase",children:"Pending"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center gap-1 text-cyan-400",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xl font-bold",children:Z(D.totalArrAtRisk)})]}),e.jsx("span",{className:"text-[10px] text-white/40 uppercase",children:"ARR at Risk"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center gap-1 text-emerald-400",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-xl font-bold",children:[D.complianceScore,"%"]})]}),e.jsx("span",{className:"text-[10px] text-white/40 uppercase",children:"Compliance"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center bg-white/5 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>u("portfolio"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-all ${a.mode==="portfolio"?"bg-cyan-500 text-white":"text-white/60 hover:text-white"}`,children:"Portfolio"}),e.jsx("button",{onClick:()=>u("crisis"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-all ${a.mode==="crisis"?"bg-rose-500 text-white":"text-white/60 hover:text-white"}`,children:"Crisis"})]}),e.jsxs("select",{className:"bg-white/5 border border-white/10 rounded-lg px-3 py-1.5 text-xs text-white",onChange:o=>o.target.value&&S(o.target.value),defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Jump to Cluster..."}),c.map(o=>e.jsxs("option",{value:o.id,children:[o.name," (",o.severity,")"]},o.id))]}),e.jsxs("div",{className:"flex items-center gap-1 bg-white/5 rounded-lg px-2 py-1",children:[e.jsx("button",{onClick:()=>m(a.zoom*.8),className:"p-1 hover:bg-white/10 rounded",children:e.jsx(ce,{className:"w-4 h-4 text-white/60"})}),e.jsxs("span",{className:"text-xs text-white/60 w-12 text-center",children:[Math.round(a.zoom*100),"%"]}),e.jsx("button",{onClick:()=>m(a.zoom*1.25),className:"p-1 hover:bg-white/10 rounded",children:e.jsx(le,{className:"w-4 h-4 text-white/60"})}),e.jsx("button",{onClick:d,className:"p-1 hover:bg-white/10 rounded ml-1",title:"Reset View",children:e.jsx(de,{className:"w-4 h-4 text-white/60"})})]}),e.jsx("button",{onClick:O,className:`p-2 rounded-lg transition-colors ${R?"bg-cyan-500/20 text-cyan-400":"bg-white/5 text-white/60 hover:text-white"}`,title:"Toggle Minimap",children:R?e.jsx(xe,{className:"w-4 h-4"}):e.jsx(me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:T,className:"p-2 bg-white/5 hover:bg-white/10 rounded-lg text-white/60 hover:text-white transition-colors",title:"Presentation Mode (Ctrl+P)",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx("button",{onClick:_,className:"p-2 bg-white/5 hover:bg-white/10 rounded-lg text-white/60 hover:text-white transition-colors",title:"Reset to Default",children:e.jsx(pe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{ref:r,className:`flex-1 relative overflow-hidden ${l?"cursor-grabbing":"cursor-grab"}`,onWheel:W,onMouseDown:H,onMouseMove:U,onMouseUp:X,onMouseLeave:X,onClick:G,children:[e.jsxs("div",{className:"absolute inset-0",style:{transform:`translate(${a.pan.x}px, ${a.pan.y}px) scale(${a.zoom})`,transformOrigin:"0 0"},children:[e.jsx("div",{className:"absolute pointer-events-none",style:{left:-5e3,top:-5e3,width:1e4,height:1e4,backgroundImage:`
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px)
              `,backgroundSize:"50px 50px"}}),e.jsx(Xe,{connections:v,nodes:g,selectedConnectionId:P,hoveredConnectionId:w,onSelectConnection:C,zoom:a.zoom}),g.map(o=>e.jsx(Pe,{node:o,isSelected:o.id===L,isHovered:o.id===V,zoom:a.zoom,onSelect:()=>k(o.id),onHover:b=>I(b?o.id:void 0),onMove:b=>h(o.id,b),onToggleCollapse:()=>N(o.id),onRemove:()=>M(o.id),widgetComponent:K(o.widgetType)},o.id))]}),R&&e.jsx(Be,{nodes:g,clusters:c,viewport:a,canvasSize:s,onNavigate:p}),P&&e.jsx($e,{connectionId:P,connections:v,onClose:()=>C(void 0)}),z&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-black/80 backdrop-blur-md rounded-full px-6 py-2 flex items-center gap-4",children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Presentation Mode"}),e.jsx("button",{onClick:T,className:"text-white/80 hover:text-white text-sm font-medium",children:"Exit (Ctrl+P)"})]})]})]})},$e=({connectionId:t,connections:r,onClose:s})=>{const i=r.find(l=>l.id===t);return i?e.jsxs("div",{className:"absolute bottom-4 left-4 w-96 bg-slate-900/95 backdrop-blur-md rounded-xl border border-white/10 shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-white",children:"Argumentationskæde"}),e.jsx("button",{onClick:s,className:"text-white/40 hover:text-white",children:"×"})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-white/40 uppercase",children:"Forbindelse"}),e.jsx("p",{className:"text-sm text-white font-medium",children:i.label})]}),i.svpBudskab&&e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsx("span",{className:"text-xs text-cyan-400 uppercase block mb-1",children:"SVP Budskab"}),e.jsxs("p",{className:"text-sm text-white/80 italic",children:['"',i.svpBudskab,'"']})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/50",children:[e.jsx("span",{className:`px-2 py-0.5 rounded ${i.connectionType==="causal"?"bg-rose-500/20 text-rose-400":i.connectionType==="regulatory"?"bg-amber-500/20 text-amber-400":i.connectionType==="financial"?"bg-blue-500/20 text-blue-400":"bg-purple-500/20 text-purple-400"}`,children:i.connectionType}),e.jsx("span",{children:i.style})]})]})]}):null};export{Le as default};
