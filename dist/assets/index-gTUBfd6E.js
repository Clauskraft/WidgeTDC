import{r as m,j as e,R as ne,A as ie,M as re,n as le,Z as P,D as f,N as L,T as C,W as ce,O as oe,d as E,Q as de,V as xe,X as he,Y as M,H as G,_ as V,$ as W,a0 as U,F as X,a1 as Z,a2 as q,a3 as me,b as ue,G as pe}from"./ui-d27jHJxv.js";import"./vendor-BerfLJhL.js";const ve=()=>{const[t,l]=m.useState(null),[i,u]=m.useState(null),[d,h]=m.useState([]),[a,p]=m.useState(null),[J,Q]=m.useState(!0),[R,g]=m.useState(null),[j,Y]=m.useState("health"),b=m.useRef(null),w=async()=>{try{const n=await(await fetch("http://localhost:3000/api/hanspedder/status")).json();n.success?(l(n.data),g(null)):g(n.error)}catch{g("Kunne ikke hente status")}finally{Q(!1)}},v=async()=>{try{const n=await(await fetch("http://localhost:3000/api/data/stats")).json();if(n.success&&n.stats)b.current=a,p(n.stats);else{const c=$();b.current=a,p(c)}}catch{const s=$();b.current=a,p(s)}},$=()=>{const x=Date.now()%864e5/36e5,r=Math.floor(x*12);return{totalDocuments:1247+r,totalChunks:8934+r*7,totalSizeBytes:45678912+r*36500,growth24h:Math.floor(r*.8),growthRate:11.7,bySource:{outlook:{count:456+Math.floor(r*.3),sizeBytes:12345678},threat_intel:{count:234+Math.floor(r*.25),sizeBytes:8901234},news:{count:189+Math.floor(r*.2),sizeBytes:7654321},local_files:{count:167+Math.floor(r*.15),sizeBytes:9876543},wikipedia:{count:134+Math.floor(r*.07),sizeBytes:4567890},pubmed:{count:67+Math.floor(r*.03),sizeBytes:2333246}},history:ee(1247+r)}},ee=s=>{const n=[],c=new Date;for(let o=23;o>=0;o--){const x=new Date(c.getTime()-o*36e5),r=s-Math.floor((24-o)*11.7);n.push({timestamp:x.toISOString(),total:Math.max(0,r)})}return n},y=async()=>{try{const n=await(await fetch("http://localhost:3000/api/ingestion/status")).json();n.success&&n.sources?h(n.sources.map(c=>({...c,icon:te(c.type)}))):h(k())}catch{h(k())}},te=s=>({email:e.jsx(M,{className:"w-4 h-4"}),outlook:e.jsx(M,{className:"w-4 h-4"}),web:e.jsx(pe,{className:"w-4 h-4"}),local:e.jsx(G,{className:"w-4 h-4"}),browser:e.jsx(V,{className:"w-4 h-4"}),pubmed:e.jsx(X,{className:"w-4 h-4"}),wikipedia:e.jsx(U,{className:"w-4 h-4"}),vector:e.jsx(f,{className:"w-4 h-4"}),threat:e.jsx(C,{className:"w-4 h-4"}),news:e.jsx(W,{className:"w-4 h-4"})})[s]||e.jsx(ue,{className:"w-4 h-4"}),k=()=>{var s,n,c,o,x,r,I,O,A,H,_,K;return[{id:"vidensarkiv",name:"Vidensarkiv",type:"vector",status:t!=null&&t.health.vectorStoreResponsive?"active":"inactive",lastSync:(t==null?void 0:t.health.lastIngestion)||null,recordCount:(a==null?void 0:a.totalDocuments)||0,icon:e.jsx(f,{className:"w-4 h-4"})},{id:"outlook",name:"Outlook Emails",type:"email",status:"active",lastSync:null,recordCount:((n=(s=a==null?void 0:a.bySource)==null?void 0:s.outlook)==null?void 0:n.count)||0,icon:e.jsx(M,{className:"w-4 h-4"})},{id:"local_files",name:"Local Files",type:"local",status:"active",lastSync:null,recordCount:((o=(c=a==null?void 0:a.bySource)==null?void 0:c.local_files)==null?void 0:o.count)||0,icon:e.jsx(G,{className:"w-4 h-4"})},{id:"browser_history",name:"Browser History",type:"browser",status:"inactive",lastSync:null,recordCount:0,icon:e.jsx(V,{className:"w-4 h-4"})},{id:"threat_intel",name:"Threat Intelligence",type:"threat",status:"active",lastSync:null,recordCount:((r=(x=a==null?void 0:a.bySource)==null?void 0:x.threat_intel)==null?void 0:r.count)||0,icon:e.jsx(C,{className:"w-4 h-4"})},{id:"news_monitor",name:"News Monitor",type:"news",status:"active",lastSync:null,recordCount:((O=(I=a==null?void 0:a.bySource)==null?void 0:I.news)==null?void 0:O.count)||0,icon:e.jsx(W,{className:"w-4 h-4"})},{id:"wikipedia",name:"Wikipedia MCP",type:"wikipedia",status:t!=null&&t.health.mcpConnected?"active":"inactive",lastSync:null,recordCount:((H=(A=a==null?void 0:a.bySource)==null?void 0:A.wikipedia)==null?void 0:H.count)||0,icon:e.jsx(U,{className:"w-4 h-4"})},{id:"pubmed",name:"PubMed MCP",type:"pubmed",status:t!=null&&t.health.mcpConnected?"active":"inactive",lastSync:null,recordCount:((K=(_=a==null?void 0:a.bySource)==null?void 0:_.pubmed)==null?void 0:K.count)||0,icon:e.jsx(X,{className:"w-4 h-4"})}]},se=async()=>{const s=t!=null&&t.isRunning?"stop":"start";try{await fetch(`http://localhost:3000/api/hanspedder/${s}`,{method:"POST"}),w()}catch{g("Kunne ikke ændre agent status")}},B=s=>{if(s===0)return"0 B";const n=1024,c=["B","KB","MB","GB","TB"],o=Math.floor(Math.log(s)/Math.log(n));return parseFloat((s/Math.pow(n,o)).toFixed(1))+" "+c[o]},T=s=>s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(1)+"K":s.toString();if(m.useEffect(()=>{w(),y(),v();const s=setInterval(()=>{w(),y(),v()},1e4),n=new WebSocket("ws://localhost:3001/mcp/ws");return n.onmessage=c=>{var o;try{const x=JSON.parse(c.data);x.type==="hanspedder:test-results"?w():x.type==="hanspedder:nudge"?u(x.payload):(o=x.type)!=null&&o.startsWith("ingestion:")&&(y(),v())}catch{}},()=>{clearInterval(s),n.close()}},[]),m.useEffect(()=>{(t||a)&&h(k())},[t==null?void 0:t.health.vectorStoreResponsive,t==null?void 0:t.health.mcpConnected,a]),J)return e.jsx("div",{className:"w-full h-full bg-slate-950 flex items-center justify-center",children:e.jsx(ne,{className:"w-8 h-8 text-cyan-400 animate-spin"})});const ae=(t==null?void 0:t.recentTests.filter(s=>s.passed).length)||0,F=(t==null?void 0:t.recentTests.length)||0,S=F>0?Math.round(ae/F*100):0,z=d.filter(s=>s.status==="active").length,N=a?a.growthRate>10?{icon:e.jsx(q,{className:"w-3 h-3"}),color:"text-green-400",text:`+${a.growthRate.toFixed(1)}/t`}:a.growthRate>0?{icon:e.jsx(q,{className:"w-3 h-3"}),color:"text-yellow-400",text:`+${a.growthRate.toFixed(1)}/t`}:{icon:e.jsx(Z,{className:"w-3 h-3"}),color:"text-white/40",text:"0/t"}:{icon:e.jsx(Z,{className:"w-3 h-3"}),color:"text-white/40",text:"—"};return e.jsxs("div",{className:"w-full h-full bg-slate-950 overflow-auto",children:[e.jsxs("header",{className:"sticky top-0 z-10 px-4 py-3 border-b border-white/10 bg-black/80 backdrop-blur-xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${t!=null&&t.isRunning?"bg-green-500/20":"bg-red-500/20"}`,children:e.jsx(ie,{className:`w-5 h-5 ${t!=null&&t.isRunning?"text-green-400":"text-red-400"}`})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"HansPedder Agent"}),e.jsx("p",{className:"text-xs text-white/50",children:t!=null&&t.isRunning?`Kører • ${z} kilder aktive`:"Stoppet"})]})]}),e.jsx("button",{onClick:se,className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${t!=null&&t.isRunning?"bg-red-500/20 text-red-400 hover:bg-red-500/30":"bg-green-500/20 text-green-400 hover:bg-green-500/30"}`,children:t!=null&&t.isRunning?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4"}),"Stop"]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4"}),"Start"]})})]}),e.jsx("div",{className:"flex gap-2 mt-3",children:[{id:"health",label:"Health",icon:e.jsx(P,{className:"w-3.5 h-3.5"})},{id:"sources",label:"Datakilder",icon:e.jsx(f,{className:"w-3.5 h-3.5"})},{id:"nudges",label:"Nudges",icon:e.jsx(L,{className:"w-3.5 h-3.5"})}].map(s=>e.jsxs("button",{onClick:()=>Y(s.id),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors ${j===s.id?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30":"text-white/50 hover:text-white/80 hover:bg-white/5"}`,children:[s.icon,s.label]},s.id))})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[R&&e.jsxs("div",{className:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-sm text-red-400",children:R})]}),e.jsx(ge,{dataStats:a,formatBytes:B,formatNumber:T,growth:N}),j==="health"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(D,{icon:e.jsx(f,{className:"w-4 h-4"}),label:"Vector Store",status:t==null?void 0:t.health.vectorStoreResponsive}),e.jsx(D,{icon:e.jsx(ce,{className:"w-4 h-4"}),label:"MCP Connected",status:t==null?void 0:t.health.mcpConnected}),e.jsx(D,{icon:e.jsx(oe,{className:"w-4 h-4"}),label:"Data Flow",status:t==null?void 0:t.health.dataflowOk})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl border border-white/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-white flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-yellow-400"}),"Test Resultater"]}),e.jsxs("span",{className:`text-2xl font-bold ${S>=80?"text-green-400":S>=50?"text-yellow-400":"text-red-400"}`,children:[S,"%"]})]}),e.jsx("div",{className:"space-y-2",children:t==null?void 0:t.recentTests.slice(-6).map((s,n)=>e.jsxs("div",{className:"flex items-center justify-between py-1.5 px-2 rounded bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.passed?e.jsx(E,{className:"w-4 h-4 text-green-400"}):e.jsx(de,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-xs text-white/80",children:s.name})]}),e.jsxs("span",{className:"text-[10px] text-white/40",children:[s.duration,"ms"]})]},n))})]}),(t==null?void 0:t.health.lastIngestion)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/40",children:[e.jsx(xe,{className:"w-3 h-3"}),"Sidste data ingestion: ",new Date(t.health.lastIngestion).toLocaleTimeString("da-DK")]})]}),j==="sources"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:"Datakilder"}),e.jsxs("span",{className:"text-xs text-white/50",children:[z,"/",d.length," aktive"]})]}),a&&e.jsxs("div",{className:"bg-white/5 rounded-xl border border-white/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-xs font-medium text-white/60 flex items-center gap-2",children:[e.jsx(he,{className:"w-3.5 h-3.5"}),"Data Vækst (24t)"]}),e.jsxs("span",{className:`text-xs font-medium ${N.color} flex items-center gap-1`,children:[N.icon,N.text]})]}),e.jsx(je,{history:a.history})]}),e.jsx("div",{className:"grid gap-2",children:d.map(s=>{var n;return e.jsx(we,{source:s,stats:(n=a==null?void 0:a.bySource)==null?void 0:n[s.id==="vidensarkiv"?"total":s.id.replace("_monitor","")],formatNumber:T,formatBytes:B},s.id)})}),e.jsxs("div",{className:"mt-4 p-3 bg-gradient-to-r from-cyan-500/10 to-purple-500/10 rounded-lg border border-white/10",children:[e.jsxs("p",{className:"text-xs text-white/60",children:[e.jsx("span",{className:"text-cyan-400 font-medium",children:"DataScheduler"})," kører automatisk:"]}),e.jsxs("ul",{className:"mt-2 space-y-1 text-[10px] text-white/50",children:[e.jsx("li",{children:"• Outlook emails: hvert 5. minut"}),e.jsx("li",{children:"• Threat Intelligence: hvert 15. minut"}),e.jsx("li",{children:"• Internal Leak Hunt: hvert 10. minut"}),e.jsx("li",{children:"• News Monitor: hver time"}),e.jsx("li",{children:"• System Heartbeat: hvert minut"})]})]})]}),j==="nudges"&&e.jsxs(e.Fragment,{children:[i&&e.jsxs("div",{className:"bg-purple-500/10 rounded-xl border border-purple-500/30 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(L,{className:"w-4 h-4 text-purple-400"}),e.jsx("h3",{className:"text-sm font-medium text-purple-300",children:"Seneste Forbedringsnudge"})]}),e.jsx("p",{className:"text-white font-medium mb-2",children:i.area}),e.jsx("ul",{className:"space-y-1",children:i.suggestions.slice(0,3).map((s,n)=>e.jsxs("li",{className:"text-xs text-white/60 flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-400",children:"•"}),s]},n))}),e.jsxs("p",{className:"text-[10px] text-white/40 mt-2",children:[i.remaining," områder tilbage i denne cyklus"]})]}),(t==null?void 0:t.nudgedAreas)&&t.nudgedAreas.length>0&&e.jsxs("div",{className:"bg-white/5 rounded-xl border border-white/10 p-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-white mb-3 flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-green-400"}),"Gennemgåede Områder"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.nudgedAreas.map(s=>e.jsx("span",{className:"px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded-full",children:s},s))})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl border border-white/10 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white mb-3",children:"Forbedringsområder (30 min cyklus)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-[10px]",children:["error-handling","loading-states","empty-states","data-freshness","connection-recovery","cache-optimization","api-retry-logic","user-feedback","accessibility","performance-monitoring"].map(s=>{var n;return e.jsx("div",{className:`px-2 py-1.5 rounded ${(n=t==null?void 0:t.nudgedAreas)!=null&&n.includes(s)?"bg-green-500/20 text-green-400":"bg-white/5 text-white/40"}`,children:s},s)})})]})]})]})]})},ge=({dataStats:t,formatBytes:l,formatNumber:i,growth:u})=>t?e.jsxs("div",{className:"bg-gradient-to-r from-cyan-500/10 via-purple-500/10 to-pink-500/10 rounded-xl border border-white/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-white flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-cyan-400"}),"Data Volume"]}),e.jsxs("div",{className:`flex items-center gap-1 text-xs font-medium ${u.color}`,children:[u.icon,e.jsx("span",{children:u.text})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:i(t.totalDocuments)}),e.jsx("div",{className:"text-[10px] text-white/50",children:"Dokumenter"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-cyan-400",children:i(t.totalChunks)}),e.jsx("div",{className:"text-[10px] text-white/50",children:"Chunks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:l(t.totalSizeBytes)}),e.jsx("div",{className:"text-[10px] text-white/50",children:"Total Størrelse"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:["+",t.growth24h]}),e.jsx("div",{className:"text-[10px] text-white/50",children:"Sidste 24t"})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between text-[10px] text-white/40 mb-1",children:[e.jsx("span",{children:"Vækst Rate"}),e.jsxs("span",{children:[t.growthRate.toFixed(1)," docs/time"]})]}),e.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-400 to-purple-400 rounded-full transition-all duration-500",style:{width:`${Math.min(100,t.growthRate/20*100)}%`}})})]})]}):null,je=({history:t})=>{if(!t||t.length===0)return null;const l=Math.max(...t.map(d=>d.total)),i=Math.min(...t.map(d=>d.total)),u=l-i||1;return e.jsx("div",{className:"h-16 flex items-end gap-0.5",children:t.slice(-24).map((d,h)=>{const a=(d.total-i)/u*100,p=h>=t.length-4;return e.jsx("div",{className:`flex-1 rounded-t transition-all ${p?"bg-cyan-400":"bg-white/20"}`,style:{height:`${Math.max(4,a)}%`},title:`${new Date(d.timestamp).toLocaleTimeString("da-DK",{hour:"2-digit",minute:"2-digit"})}: ${d.total} docs`},h)})})},D=({icon:t,label:l,status:i})=>e.jsxs("div",{className:`p-3 rounded-lg border ${i?"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:i?"text-green-400":"text-red-400",children:t}),e.jsx("span",{className:"text-xs text-white/60",children:l})]}),e.jsx("div",{className:`text-sm font-medium ${i?"text-green-400":"text-red-400"}`,children:i?"OK":"Fejl"})]}),we=({source:t,stats:l,formatNumber:i,formatBytes:u})=>{const d={active:"bg-green-500/20 border-green-500/30 text-green-400",inactive:"bg-white/5 border-white/10 text-white/40",error:"bg-red-500/20 border-red-500/30 text-red-400"},h=t.recordCount||(l==null?void 0:l.count)||0,a=(l==null?void 0:l.sizeBytes)||0;return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${d[t.status]}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${t.status==="active"?"bg-green-500/20":t.status==="error"?"bg-red-500/20":"bg-white/10"}`,children:t.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:t.name}),e.jsx("p",{className:"text-[10px] text-white/40",children:t.type})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-xs font-medium ${t.status==="active"?"text-green-400":t.status==="error"?"text-red-400":"text-white/40"}`,children:t.status==="active"?"● Online":t.status==="error"?"● Error":"○ Offline"}),h>0&&e.jsxs("p",{className:"text-[10px] text-white/50 font-medium",children:[i(h)," docs",a>0&&e.jsxs("span",{className:"text-white/30",children:[" • ",u(a)]})]}),t.lastSync&&e.jsx("p",{className:"text-[10px] text-white/30",children:new Date(t.lastSync).toLocaleTimeString("da-DK")})]})]})};export{ve as HansPedderMonitorWidget,ve as default};
