import{r as t,j as e}from"./ui-d27jHJxv.js";import{u as I}from"./useMCP-C6vkw6pp.js";import"./vendor-BerfLJhL.js";const k={feeds:[],pipelineStages:[{id:"ingest",name:"Ingest",service:"RSS Poller",status:"healthy",latencyMs:0},{id:"index",name:"Index",service:"Vector Store",status:"healthy",latencyMs:0}],normalizedDocuments:[],metrics:{documentsIndexed:0,ingestionLatency:0,dedupeRate:0,backlogMinutes:0},archive:{sizeBytes:0,retentionDays:30,objectCount:0},environment:{openSearchConnected:!1,minioConnected:!1}},L={healthy:"text-emerald-600",warning:"text-amber-600",error:"text-rose-600"},C={healthy:"Operational",warning:"Degraded",error:"Offline"},T=()=>{const{send:r}=I(),[c,d]=t.useState(""),[o,D]=t.useState("all"),[b,F]=t.useState(""),[m,E]=t.useState(!0),[a,j]=t.useState(k),[v,h]=t.useState(!1),[f,u]=t.useState(null),i=t.useCallback(async()=>{try{h(!0);const s=await r("agent-orchestrator","ingestion.status",{});if(s&&s.success)j(n=>({...n,metrics:{...n.metrics,documentsIndexed:s.totalDocuments||0},environment:{openSearchConnected:!0,minioConnected:!1}})),u(null);else throw new Error("Backend error")}catch(s){console.warn("Feed ingestion refresh failed",s),u("Backend connection failed")}finally{h(!1)}},[r]);t.useEffect(()=>{i()},[i]),t.useEffect(()=>{if(!m)return;const s=setInterval(i,1e4);return()=>clearInterval(s)},[m,i]);const l=a.feeds||[],N=a.normalizedDocuments||[],p=a.metrics,S=a.pipelineStages;t.useMemo(()=>{const s=c.trim().toLowerCase();return l.filter(n=>{const w=s.length===0||n.name.toLowerCase().includes(s),y=o==="all"?!0:n.threatLevel===o;return w&&y})},[c,o,l]);const x=l.find(s=>s.id===b)||l[0];return N.filter(s=>s.feedId===(x==null?void 0:x.id)).slice(0,3),e.jsxs("div",{className:"h-full flex flex-col -m-4","data-testid":"feed-ingestion-widget",children:[e.jsxs("header",{className:"p-4 bg-slate-950/80 text-white border-b border-slate-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-white/60",children:"DATA PIPELINE"}),e.jsx("h3",{className:"text-2xl font-semibold",children:"Feed Ingestion"}),e.jsx("p",{className:"text-sm text-white/80",children:"Real-time ingestion status from backend scrapers & agents."})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex flex-col text-xs mt-2 gap-1",children:[v&&e.jsx("span",{className:"text-white/70",children:"Syncing..."}),f&&e.jsx("span",{className:"text-rose-300",children:f})]})})]}),e.jsx("div",{className:"flex gap-2 text-xs mt-3",children:e.jsxs("span",{className:`px-2 py-1 rounded-full ${a.environment.openSearchConnected?"bg-emerald-500/20 text-emerald-200":"bg-amber-500/20 text-amber-100"}`,children:["Vector Store ",a.environment.openSearchConnected?"Online":"Offline"]})})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-12 gap-4 p-4 overflow-hidden bg-slate-50 dark:bg-slate-900/30",children:[e.jsxs("section",{className:"col-span-12 lg:col-span-5 h-full flex flex-col overflow-hidden border border-slate-200 dark:border-slate-800 rounded-2xl bg-white dark:bg-slate-900/70",children:[e.jsx("div",{className:"p-4 border-b border-slate-100 dark:border-slate-800",children:e.jsx("h4",{className:"font-semibold text-sm",children:"Active Feeds"})}),e.jsx("div",{className:"flex-1 flex items-center justify-center text-slate-500 text-sm p-4",children:l.length===0?"No active feeds reporting status.":"Feeds list here..."})]}),e.jsxs("section",{className:"col-span-12 lg:col-span-7 h-full flex flex-col gap-4 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx(g,{label:"Total Documents",helper:"Indexed in Vector DB",value:p.documentsIndexed.toLocaleString()}),e.jsx(g,{label:"Latency",helper:"Avg",value:`${p.ingestionLatency} ms`})]}),e.jsxs("div",{className:"border border-slate-200 dark:border-slate-800 rounded-2xl bg-white dark:bg-slate-900/70 p-4 flex flex-col flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Pipeline Status"}),e.jsx("div",{className:"space-y-3",children:S.map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.service})]}),e.jsx("span",{className:`text-xs font-semibold ${L[s.status]}`,children:C[s.status]})]},s.id))})]})]})]})]})},g=({label:r,value:c,helper:d})=>e.jsxs("div",{className:"border border-slate-200 dark:border-slate-800 rounded-2xl bg-white dark:bg-slate-900/70 p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:r}),e.jsx("p",{className:"text-2xl font-semibold mt-1",children:c}),d&&e.jsx("p",{className:"text-xs text-slate-400",children:d})]});export{T as default};
