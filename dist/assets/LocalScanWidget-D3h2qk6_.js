import{r,j as e,H as f,R as b,m as j,n as y,T as w,I as v,F as N}from"./ui-d27jHJxv.js";import{B as S}from"./Button-CUGYQXiP.js";import{u as k}from"./useMCP-C6vkw6pp.js";import{u as C}from"./useWidgetSync-PcBW9nb4.js";import"./vendor-BerfLJhL.js";const B={path:"/tmp",depth:2,keywords:["password","secret","key","token"],intervalMin:30},P=({widgetId:m})=>{const{send:c}=k(),[s,l]=r.useState(B),[n,d]=r.useState([]),[a,x]=r.useState(!1),[i,p]=r.useState(null),[u,g]=r.useState(null);C(m,{isScanning:a,lastScan:u,findingsCount:n.length,highRiskCount:n.filter(t=>t.threatScore>7).length});const h=r.useCallback(async()=>{if(s.path){x(!0),p(null);try{const t=await c("agent-orchestrator","devtools-scan",{path:s.path,depth:s.depth,keywords:s.keywords});t&&t.files&&(d(t.files),g(new Date().toLocaleString()))}catch(t){console.error("Scan failed:",t),p("Kunne ikke scanne. Tjek permissions."),d([])}finally{x(!1)}}},[c,s]);return e.jsxs("div",{className:"h-full flex flex-col","data-testid":"local-scan-widget",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{size:18,className:"text-[#00B5CB]"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"System Scanner"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Lokal filsystem sikkerhed"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:h,disabled:a,className:`p-2 rounded-lg hover:bg-white/10 text-gray-300 transition-colors ${a?"animate-spin text-[#00B5CB]":""}`,children:e.jsx(b,{size:16})})})]}),e.jsxs("div",{className:"bg-[#0B3E6F]/20 rounded-xl p-3 mb-4 border border-white/10 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s.path,onChange:t=>l({...s,path:t.target.value}),placeholder:"/sti/til/scan",className:"flex-1 bg-black/20 border border-white/10 rounded-lg px-3 py-1.5 text-sm text-white focus:outline-none focus:border-[#00B5CB]"}),e.jsx("select",{value:s.depth,onChange:t=>l({...s,depth:parseInt(t.target.value)}),className:"bg-black/20 border border-white/10 rounded-lg px-2 py-1.5 text-sm text-white focus:outline-none",children:[1,2,3,4,5].map(t=>e.jsxs("option",{value:t,children:["Dybde: ",t]},t))})]}),e.jsx("div",{children:e.jsx("input",{type:"text",value:s.keywords.join(", "),onChange:t=>l({...s,keywords:t.target.value.split(",").map(o=>o.trim())}),placeholder:"Keywords (komma separeret)",className:"w-full bg-black/20 border border-white/10 rounded-lg px-3 py-1.5 text-sm text-white focus:outline-none focus:border-[#00B5CB]"})}),e.jsxs(S,{onClick:h,disabled:a,className:"w-full flex items-center justify-center gap-2 py-1.5 bg-[#00B5CB]/20 hover:bg-[#00B5CB]/30 text-[#00B5CB] text-sm rounded-lg transition-colors",children:[a?e.jsx(j,{size:14}):e.jsx(y,{size:14}),a?"Scanner...":"Start Scan"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-2 pr-1",children:[i&&e.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-xs flex items-center gap-2",children:[e.jsx(w,{size:14})," ",i]}),n.length===0&&!a&&!i&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-xs",children:"Ingen trusler fundet eller ingen scanning kÃ¸rt."}),n.map((t,o)=>e.jsxs("div",{className:"p-3 bg-[#0B3E6F]/20 border border-white/5 rounded-xl group hover:border-white/20 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[t.hasImage?e.jsx(v,{size:14,className:"text-purple-400"}):e.jsx(N,{size:14,className:"text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-200 truncate",title:t.fullPath,children:t.name})]}),e.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${t.threatScore>7?"bg-red-500/20 text-red-400":"bg-yellow-500/20 text-yellow-400"}`,children:["Score: ",t.threatScore]})]}),e.jsx("p",{className:"text-xs text-gray-500 font-mono truncate mb-2",children:t.fullPath}),t.snippet&&e.jsx("div",{className:"bg-black/20 p-2 rounded text-[10px] text-gray-400 font-mono line-clamp-2 border border-white/5",children:t.snippet})]},o))]})]})};export{P as default};
