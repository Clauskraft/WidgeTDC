import{e as S}from"./ui-DyG0g13d.js";import{c as O}from"./vanilla-m3Xdu9cz.js";const R=n=>n;function w(n,i=R){const r=S.useSyncExternalStore(n.subscribe,S.useCallback(()=>i(n.getState()),[n,i]),S.useCallback(()=>i(n.getInitialState()),[n,i]));return S.useDebugValue(r),r}const _=n=>{const i=O(n),r=s=>w(i,s);return Object.assign(r,i),r},N=(n=>n?_(n):_);function C(n,i){let r;try{r=n()}catch{return}return{getItem:a=>{var e;const m=d=>d===null?null:JSON.parse(d,void 0),l=(e=r.getItem(a))!=null?e:null;return l instanceof Promise?l.then(m):m(l)},setItem:(a,e)=>r.setItem(a,JSON.stringify(e,void 0)),removeItem:a=>r.removeItem(a)}}const I=n=>i=>{try{const r=n(i);return r instanceof Promise?r:{then(s){return I(s)(r)},catch(s){return this}}}catch(r){return{then(s){return this},catch(s){return I(s)(r)}}}},E=(n,i)=>(r,s,a)=>{let e={storage:C(()=>localStorage),partialize:t=>t,version:0,merge:(t,v)=>({...v,...t}),...i},m=!1;const l=new Set,d=new Set;let c=e.storage;if(!c)return n((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${e.name}', the given storage is currently unavailable.`),r(...t)},s,a);const y=()=>{const t=e.partialize({...s()});return c.setItem(e.name,{state:t,version:e.version})},H=a.setState;a.setState=(t,v)=>(H(t,v),y());const h=n((...t)=>(r(...t),y()),s,a);a.getInitialState=()=>h;let f;const b=()=>{var t,v;if(!c)return;m=!1,l.forEach(o=>{var u;return o((u=s())!=null?u:h)});const g=((v=e.onRehydrateStorage)==null?void 0:v.call(e,(t=s())!=null?t:h))||void 0;return I(c.getItem.bind(c))(e.name).then(o=>{if(o)if(typeof o.version=="number"&&o.version!==e.version){if(e.migrate){const u=e.migrate(o.state,o.version);return u instanceof Promise?u.then(p=>[!0,p]):[!0,u]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,o.state];return[!1,void 0]}).then(o=>{var u;const[p,k]=o;if(f=e.merge(k,(u=s())!=null?u:h),r(f,!0),p)return y()}).then(()=>{g==null||g(f,void 0),f=s(),m=!0,d.forEach(o=>o(f))}).catch(o=>{g==null||g(void 0,o)})};return a.persist={setOptions:t=>{e={...e,...t},t.storage&&(c=t.storage)},clearStorage:()=>{c==null||c.removeItem(e.name)},getOptions:()=>e,rehydrate:()=>b(),hasHydrated:()=>m,onHydrate:t=>(l.add(t),()=>{l.delete(t)}),onFinishHydration:t=>(d.add(t),()=>{d.delete(t)})},e.skipHydration||b(),f||h},P=E;export{N as c,P as p};
