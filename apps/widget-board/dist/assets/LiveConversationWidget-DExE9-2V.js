import{j as i}from"./index-DZEoTVC4.js";import{r as s,M as k,w as S}from"./ui-DyG0g13d.js";import{G as B,M as I}from"./index-CHxrVzz6.js";import{M}from"./MatrixWidgetWrapper-mghho8C4.js";import"./vendor-Cv91Oj79.js";import"./graph-i8PIyU_l.js";import"./grid-BAREo1Ej.js";const _={};function F(r){const c=atob(r),v=c.length,t=new Uint8Array(v);for(let l=0;l<v;l++)t[l]=c.charCodeAt(l);return t}function G(r){let c="";const v=r.byteLength;for(let t=0;t<v;t++)c+=String.fromCharCode(r[t]);return btoa(c)}async function z(r,c,v,t){const l=new Int16Array(r.buffer),C=l.length/t,D=c.createBuffer(t,C,v);for(let g=0;g<t;g++){const W=D.getChannelData(g);for(let u=0;u<C;u++)W[u]=l[u*t+g]/32768}return D}const Q=()=>{const[r,c]=s.useState(!1),[v,t]=s.useState("Ready"),[l,C]=s.useState([]),D=s.useRef(null),g=s.useRef(null),W=s.useRef(null),u=s.useRef(null),x=s.useRef(null),w=s.useRef(null),j=s.useRef(0),b=s.useRef(new Set);s.useEffect(()=>{var o;(o=D.current)==null||o.scrollIntoView({behavior:"smooth"})},[l]);const T=s.useCallback(()=>{var o,f,E,p;t("Stopping..."),c(!1),(o=g.current)==null||o.then(e=>e.close()),g.current=null,(f=W.current)==null||f.getTracks().forEach(e=>e.stop()),W.current=null,(E=w.current)==null||E.disconnect(),w.current=null,(p=u.current)==null||p.close(),u.current=null,b.current.forEach(e=>e.stop()),b.current.clear(),t("Ready")},[]);s.useEffect(()=>()=>{r&&T()},[r,T]);const A=async()=>{const o=(_||{}).VITE_GEMINI_API_KEY||"";if(!o){t("No API Key found.");return}t("Initializing..."),C([]),c(!0);try{const f=await navigator.mediaDevices.getUserMedia({audio:!0});W.current=f,u.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}),x.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}),j.current=0;const E=new B({apiKey:o});g.current=E.live.connect({model:"gemini-2.5-flash-native-audio-preview-09-2025",config:{responseModalities:[I.AUDIO],inputAudioTranscription:{},outputAudioTranscription:{}},callbacks:{onopen:()=>{t("Listening...");const p=u.current.createMediaStreamSource(f);w.current=u.current.createScriptProcessor(4096,1,1),w.current.onaudioprocess=e=>{var h;const y=e.inputBuffer.getChannelData(0),L={data:G(new Uint8Array(new Int16Array(y.map(N=>N*32768)).buffer)),mimeType:"audio/pcm;rate=16000"};(h=g.current)==null||h.then(N=>N.sendRealtimeInput({media:L}))},p.connect(w.current),w.current.connect(u.current.destination)},onmessage:async p=>{var L,h,N,P,U,V;const e=p.serverContent;if(e!=null&&e.inputTranscription){const n=e.inputTranscription.text||"",a=!!e.turnComplete;n&&C(m=>{const d=m[m.length-1];return(d==null?void 0:d.speaker)==="user"&&!d.isFinal?[...m.slice(0,-1),{speaker:"user",text:n,isFinal:a}]:[...m,{speaker:"user",text:n,isFinal:a}]})}if(e!=null&&e.modelTurn){const n=(h=(L=e.modelTurn.parts)==null?void 0:L[0])==null?void 0:h.text,a=!!e.turnComplete;n&&C(m=>{const d=m[m.length-1];return(d==null?void 0:d.speaker)==="model"&&!d.isFinal?[...m.slice(0,-1),{speaker:"model",text:n,isFinal:a}]:[...m,{speaker:"model",text:n,isFinal:a}]})}const y=(V=(U=(P=(N=e==null?void 0:e.modelTurn)==null?void 0:N.parts)==null?void 0:P[0])==null?void 0:U.inlineData)==null?void 0:V.data;if(y&&x.current){t("Speaking...");const n=await z(F(y),x.current,24e3,1),a=x.current.createBufferSource();a.buffer=n,a.connect(x.current.destination);const m=x.current.currentTime,d=Math.max(m,j.current);a.start(d),j.current=d+n.duration,b.current.add(a),a.onended=()=>{b.current.delete(a),b.current.size===0&&t("Listening...")}}e!=null&&e.interrupted&&(b.current.forEach(n=>n.stop()),b.current.clear(),j.current=0)},onclose:()=>{t("Connection closed."),T()},onerror:p=>{const e=p.message||"Unknown WebSocket error.";console.error("Live Conversation WebSocket error:",e,p),t(`Connection error: ${e}`),T()}}})}catch(f){console.error("Could not start conversation:",f),t("Microphone access failed."),c(!1)}},R=()=>{r?T():A()};return i.jsxDEV(M,{title:"Gemini Live Voice",children:i.jsxDEV("div",{className:"flex flex-col h-full",children:[i.jsxDEV("div",{className:"flex-1 overflow-y-auto space-y-3 p-1 custom-scrollbar",children:[l.length===0&&!r&&i.jsxDEV("div",{className:"h-full flex flex-col items-center justify-center text-gray-500/40 gap-2",children:[i.jsxDEV("div",{className:"w-12 h-12 rounded-full bg-white/5 flex items-center justify-center",children:i.jsxDEV(k,{size:24,strokeWidth:1.5},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:244,columnNumber:33},void 0)},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:243,columnNumber:29},void 0),i.jsxDEV("p",{className:"text-xs text-center max-w-[200px]",children:"Real-time voice conversation with Gemini 2.0 Flash"},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:246,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:242,columnNumber:26},void 0),l.map((o,f)=>i.jsxDEV("div",{className:`flex ${o.speaker==="user"?"justify-end":"justify-start"}`,children:i.jsxDEV("div",{className:`p-3 rounded-xl max-w-[85%] text-xs ${o.speaker==="user"?"bg-[#00B5CB]/20 text-white border border-[#00B5CB]/30":"bg-white/5 text-gray-300 border border-white/10"} ${o.isFinal?"":"opacity-70"}`,children:o.text},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:252,columnNumber:29},void 0)},f,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:251,columnNumber:25},void 0)),i.jsxDEV("div",{ref:D},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:261,columnNumber:22},void 0)]},void 0,!0,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:240,columnNumber:17},void 0),i.jsxDEV("div",{className:"pt-4 mt-2 border-t border-white/5 flex flex-col items-center gap-3",children:[i.jsxDEV("div",{className:"flex items-center gap-2 text-[10px] font-medium text-gray-400",children:[r&&i.jsxDEV("span",{className:"flex h-2 w-2 relative",children:[i.jsxDEV("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:269,columnNumber:33},void 0),i.jsxDEV("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-500"},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:270,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:268,columnNumber:29},void 0),i.jsxDEV("span",{children:v},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:273,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:266,columnNumber:21},void 0),i.jsxDEV("button",{onClick:R,className:`
                            w-14 h-14 rounded-full flex items-center justify-center transition-all shadow-lg
                            ${r?"bg-red-500/20 text-red-400 border-2 border-red-500/50 hover:bg-red-500/30":"bg-[#00B5CB]/20 text-[#00B5CB] border-2 border-[#00B5CB]/50 hover:bg-[#00B5CB]/30 hover:scale-105"}
                        `,children:r?i.jsxDEV(S,{size:24},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:286,columnNumber:40},void 0):i.jsxDEV(k,{size:24},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:286,columnNumber:63},void 0)},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:277,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:264,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:239,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/claus/Projects/WidgeTDC/WidgeTDC/apps/widget-board/widgets/LiveConversationWidget.tsx",lineNumber:238,columnNumber:9},void 0)};export{Q as default};
